
ğŸ¥ Next.js ê¸°ë°˜ ì‘ê¸‰ ì˜ë£Œ ìœ„í—˜ ì§€ìˆ˜ ì›¹ì„œë¹„ìŠ¤ êµ¬í˜„ ë¡œë“œë§µ
ì œì‹œí•´ ì£¼ì‹  í”„ë¡œì íŠ¸ ëª©í‘œì™€ ì ìš©ëœ í†µê³„ ê°œë…(ê¸°í•˜ ë¶„í¬, Geometric Distribution)ì„ ë°”íƒ•ìœ¼ë¡œ, Next.jsë¥¼ í™œìš©í•˜ì—¬ ì›¹ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ìƒì„¸ ë¡œë“œë§µì„ êµ¬ì„±í•´ ë“œë¦½ë‹ˆë‹¤.

Next.jsëŠ” React ê¸°ë°˜ì˜ í”„ë ˆì„ì›Œí¬ë¡œ, í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ ëª¨ë‘ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. âš™ï¸ ê°œë°œ í™˜ê²½ ë° ê¸°ìˆ  ìŠ¤íƒ ì„¤ì •
êµ¬ë¶„	ê¸°ìˆ  ìŠ¤íƒ	ì‚¬ìš© ëª©ì 
í”„ë¡ íŠ¸ì—”ë“œ	Next.js (React)	ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ë° ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§(SSR)/ì •ì  ì‚¬ì´íŠ¸ ìƒì„±(SSG)ì„ í†µí•œ ì„±ëŠ¥ ìµœì í™”
ë°±ì—”ë“œ/API	Next.js API Routes	í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì²˜ë¦¬, ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼, ì™¸ë¶€ Open API ì—°ë™ ë¡œì§ êµ¬í˜„
ë°ì´í„°ë² ì´ìŠ¤	PostgreSQL	ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì •ë³´, ë³‘ìƒ ì •ë³´ ë“± í•µì‹¬ ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬
ì§€ë„ ì„œë¹„ìŠ¤	Kakao Map API	ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™” ë° ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤ ì œê³µ
ê³µê³µ ë°ì´í„°	êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› Open API	ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì •ë³´(ì‘ê¸‰ì‹¤, ì…ì›ì‹¤ ë³‘ìƒ ìˆ˜ ë“±) ì‹¤ì‹œê°„ ë˜ëŠ” ì£¼ê¸°ì  ê°±ì‹ 
ë°°í¬	Vercel, AWS Amplify ë“±	ì›¹ì„œë¹„ìŠ¤ ë°°í¬ ë° ìš´ì˜
2. ğŸ§© í”„ë¡œì íŠ¸ êµ¬ì¡° ë° ë°ì´í„° íë¦„
Next.js App Router ê¸°ë°˜ìœ¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ê³ , app/ ë””ë ‰í† ë¦¬ ë‚´ì—ì„œ ë¼ìš°íŒ…ê³¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ (PostgreSQL):

ì‘ê¸‰ ì˜ë£Œê¸°ê´€ ëª©ë¡, ìœ„ì¹˜(ì¢Œí‘œ), ìµœì‹  ë³‘ìƒ ì •ë³´(hvec, hvgca) ë“±ì„ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì„ ì„¤ê³„í•©ë‹ˆë‹¤.

Prisma ë˜ëŠ” TypeORMê³¼ ê°™ì€ ORMì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ Next.js ë°±ì—”ë“œë¥¼ ì—°ê²°í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

ë°ì´í„° ìˆ˜ì§‘ ë° ê°±ì‹ :

Next.js API Route(pages/api/ ë˜ëŠ” app/api/)ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› Open APIì—ì„œ ë°ì´í„°ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.

í˜¸ì¶œí•œ ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ì—¬ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥(Seed)í•˜ê±°ë‚˜ ê°±ì‹ í•©ë‹ˆë‹¤.

Geometric Distribution ê³„ì‚° ë¡œì§:

ë°±ì—”ë“œ API Routeì—ì„œ ì§€ì—­ë³„ p ê°’ê³¼ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

3. ğŸ¯ í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ ë‹¨ê³„
ë‹¨ê³„ 1: ë°ì´í„°ë² ì´ìŠ¤ ë° API ì—°ë™ ()
PostgreSQL í™˜ê²½ êµ¬ì¶•: ë¡œì»¬ ë˜ëŠ” í´ë¼ìš°ë“œì— PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

ë°ì´í„° ëª¨ë¸ ì •ì˜: ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì •ë³´ í…Œì´ë¸”ì„ ì •ì˜í•˜ê³  ORMì„ ì„¤ì •í•©ë‹ˆë‹¤.

Open API ë°ì´í„° ìˆ˜ì§‘/ì €ì¥:

êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› Open APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

P = k/n ê³„ì‚°ì— í•„ìš”í•œ ì •ë³´ (ìˆ˜ìš© ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê¸°ê´€ ìˆ˜ k, ì „ì²´ ê¸°ê´€ ìˆ˜ n)ë¥¼ ì§€ì—­ë³„ë¡œ ê³„ì‚°í•˜ê³  ì €ì¥í•˜ëŠ” API ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

ë‹¨ê³„ 2: ê¸°í•˜ ë¶„í¬(Geometric Distribution) ê¸°ë°˜ ìœ„í—˜ ì§€ìˆ˜ ì‚°ì¶œ
ì„±ê³µ í™•ë¥  p ê³„ì‚° API:

íŠ¹ì • ì§€ì—­ ì½”ë“œë¥¼ ì…ë ¥ë°›ì•„ í•´ë‹¹ ì§€ì—­ì˜ kì™€ nì„ DBì—ì„œ ì¡°íšŒí•©ë‹ˆë‹¤.

ì„±ê³µ í™•ë¥  $p = \frac{k}{n}$ë¥¼ ê³„ì‚°í•˜ì—¬ ë°˜í™˜í•˜ëŠ” APIë¥¼ ë§Œë“­ë‹ˆë‹¤.

ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚° API (PMF í™œìš©):

ì‚¬ìš©ìê°€ ìš”ì²­í•œ ì§€ì—­ì˜ p ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ìˆ˜ìš© ê°€ëŠ¥í•œ ë³‘ì›ì„ ì°¾ì§€ ëª»í•  í™•ë¥ ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

P(X=x)=(1âˆ’p) 
xâˆ’1
 p ê³µì‹ì„ í™œìš©í•˜ì—¬ ë‹¤ìŒì„ ê³„ì‚°í•©ë‹ˆë‹¤.

P(fail on 1st)=P(X=1)=p (ì„±ê³µ í™•ë¥ )

P(fail on 2nd)=P(X=2)=(1âˆ’p)p

P(fail on 3rd)=P(X=3)=(1âˆ’p) 
2
 p

ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ì°¾ì§€ ëª»í•  í™•ë¥  (ìœ„í—˜ ì§€ìˆ˜)ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

ìœ„í—˜ ì§€ìˆ˜=P(X>3)=1âˆ’P(Xâ‰¤3)=1âˆ’[P(X=1)+P(X=2)+P(X=3)]
ì´ ê°’ì„ JSON í˜•íƒœë¡œ ë°˜í™˜í•˜ëŠ” APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

ë‹¨ê³„ 3: Next.js í”„ë¡ íŠ¸ì—”ë“œ ë° ì§€ë„ ì‹œê°í™”
Kakao Map API ì—°ë™:

Kakao ê°œë°œì ì„¼í„°ì—ì„œ JavaScript í‚¤ë¥¼ ë°œê¸‰ë°›ê³  ì›¹ í”Œë«í¼ì„ ë“±ë¡í•©ë‹ˆë‹¤.

Next.js ì»´í¬ë„ŒíŠ¸ì— Kakao Mapì„ ë¡œë“œí•˜ê³  ì§€ë„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. (Next.jsì—ì„œ <Script> íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, react-kakao-maps-sdk ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê¶Œì¥)

ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™”:

ì‚¬ìš©ìê°€ ì„ íƒí•œ ì§€ì—­ ë˜ëŠ” ì „ì²´ ì§€ì—­ì— ëŒ€í•´ ë‹¨ê³„ 2ì˜ ìœ„í—˜ ì§€ìˆ˜ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

ì§€ë„ ìœ„ì— í–‰ì • êµ¬ì—­ë³„ ê²½ê³„ë¥¼ í‘œì‹œí•˜ëŠ” Polyline ë˜ëŠ” Polygon ê¸°ëŠ¥ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

ê³„ì‚°ëœ ìœ„í—˜ ì§€ìˆ˜ ê°’ì— ë”°ë¼ ì§€ë„ ìœ„ì— í‘œì‹œë˜ëŠ” ì§€ì—­ì˜ ìƒ‰ìƒ(Color) ë˜ëŠ” íˆ¬ëª…ë„(Opacity)ë¥¼ ë‹¤ë¥´ê²Œ ì ìš©í•˜ì—¬ ìœ„í—˜ë„ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•©ë‹ˆë‹¤ (ì˜ˆ: ìœ„í—˜í• ìˆ˜ë¡ ë¶‰ì€ìƒ‰, ì•ˆì „í• ìˆ˜ë¡ í‘¸ë¥¸ìƒ‰).

ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤(UI) ê°œë°œ:

ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´/ê²€ìƒ‰ ê¸°ëŠ¥.

ì„ íƒëœ ì§€ì—­ì˜ ìœ„í—˜ ì§€ìˆ˜ ë° p ê°’ì„ í‘œì‹œí•˜ëŠ” ëŒ€ì‹œë³´ë“œ.

ìˆ˜ìš© ì¡°ê±´(ì‘ê¸‰ì‹¤/ì…ì›ì‹¤ ë³‘ìƒ ìœ ë¬´, êµ¬ê¸‰ì°¨ ê°€ëŠ¥ ì—¬ë¶€)ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ í‘œì‹œ.

4. ğŸš€ ë‹¤ìŒ ë‹¨ê³„
ê°€ì¥ ë¨¼ì € ì°©ìˆ˜í•´ì•¼ í•  ë‹¨ê³„ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •ê³¼ Open APIë¥¼ í†µí•œ ì´ˆê¸° ë°ì´í„° ìˆ˜ì§‘ ë° ê°±ì‹  ë¡œì§ êµ¬í˜„ì…ë‹ˆë‹¤.

Next.js í™˜ê²½ì—ì„œ PostgreSQL ì—°ê²° ë° ë°ì´í„° ì´ˆê¸° ë¡œë“œ(Seeding)ë¥¼ ìœ„í•œ Next.js API Routes êµ¬í˜„ì— ëŒ€í•œ ìƒì„¸ ê°€ì´ë“œê°€ í•„ìš”í•˜ì‹ ê°€ìš”?

API ì •ë³´



OpenAPI ì •ë³´

 ë©”íƒ€ë°ì´í„° ë‹¤ìš´ë¡œë“œ

 ì˜¤í”ˆAPI ì—ëŸ¬ì½”ë“œ

ë°ì´í„° ê°œì„ ìš”ì²­

ì˜¤ë¥˜ì‹ ê³  ë° ë¬¸ì˜

ë¶„ë¥˜ì²´ê³„ë³´ê±´ - ë³´ê±´ì˜ë£Œì œê³µê¸°ê´€êµ­ë¦½ì¤‘ì•™ì˜ë£Œì›ê´€ë¦¬ë¶€ì„œëª…ì‘ê¸‰ì˜ë£Œì •ë³´í™”íŒ€ê´€ë¦¬ë¶€ì„œ ì „í™”ë²ˆí˜¸02-6362-3451API ìœ í˜•RESTë°ì´í„°í¬ë§·XMLí™œìš©ì‹ ì²­3578í‚¤ì›Œë“œì‘ê¸‰ì˜ë£Œê¸°ê´€,ì‘ê¸‰ì‹¤,ì‘ê¸‰ì˜ë£Œë“±ë¡ì¼2017-03-16ìˆ˜ì •ì¼2025-07-03ë¹„ìš©ë¶€ê³¼ìœ ë¬´ë¬´ë£Œì‹ ì²­ê°€ëŠ¥ íŠ¸ë˜í”½ê°œë°œê³„ì • : 1,000 / ìš´ì˜ê³„ì • : í™œìš©ì‚¬ë¡€ ë“±ë¡ì‹œ ì‹ ì²­í•˜ë©´ íŠ¸ë˜í”½ ì¦ê°€ ê°€ëŠ¥ì‹¬ì˜ìœ í˜•ê°œë°œë‹¨ê³„ : ìë™ìŠ¹ì¸ / ìš´ì˜ë‹¨ê³„ : ìë™ìŠ¹ì¸ê³µê°„ë²”ìœ„ì „êµ­ì‹œê°„ë²”ìœ„2025ë…„ 2ì›”ì´ìš©í—ˆë½ë²”ìœ„ì´ìš©í—ˆë½ë²”ìœ„ ì œí•œ ì—†ìŒì°¸ê³ ë¬¸ì„œNIA-IFT-OpenAPIí™œìš©ê°€ì´ë“œ-01.êµ­ë¦½ì¤‘ì•™ì˜ë£Œì›-ì‘ê¸‰ì˜ë£Œì •ë³´ì¡°íšŒì„œë¹„ìŠ¤_V4.hwp

ìƒì„¸ê¸°ëŠ¥

í™œìš©ì‚¬ë¡€

ì¶”ì²œë°ì´í„°

ìƒì„¸ê¸°ëŠ¥

ëª©ë¡                                                                                                                                                                ì‘ê¸‰ì‹¤ ì‹¤ì‹œê°„ ê°€ìš©ë³‘ìƒì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì¤‘ì¦ì§ˆí™˜ì ìˆ˜ìš©ê°€ëŠ¥ì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì‘ê¸‰ì˜ë£Œê¸°ê´€ ëª©ë¡ì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì‘ê¸‰ì˜ë£Œê¸°ê´€ ìœ„ì¹˜ì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì‘ê¸‰ì˜ë£Œê¸°ê´€ ê¸°ë³¸ì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì™¸ìƒì„¼í„° ëª©ë¡ì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì™¸ìƒì„¼í„° ìœ„ì¹˜ì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì™¸ìƒì„¼í„° ê¸°ë³¸ì •ë³´ ì¡°íšŒ                                                     

                                                                                                                                                               ì‘ê¸‰ì‹¤ ë° ì¤‘ì¦ì§ˆí™˜ ë©”ì‹œì§€ ì¡°íšŒ                                                     

                                                                                               ì¡°íšŒ

ì‘ê¸‰ì‹¤ì´ ë³´ìœ í•˜ê³  ìˆëŠ” ê°€ìš©ë³‘ìƒ ì •ë³´í˜„í™©ì„ ì‹œë„/ì‹œêµ°êµ¬ë³„ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

í™œìš©ìŠ¹ì¸ ì ˆì°¨ ê°œë°œë‹¨ê³„ : ìë™ìŠ¹ì¸ / ìš´ì˜ë‹¨ê³„ : ìë™ìŠ¹ì¸

ì‹ ì²­ê°€ëŠ¥ íŠ¸ë˜í”½ ê°œë°œê³„ì • : 1,000 / ìš´ì˜ê³„ì • : í™œìš©ì‚¬ë¡€ ë“±ë¡ì‹œ ì‹ ì²­í•˜ë©´ íŠ¸ë˜í”½ ì¦ê°€ ê°€ëŠ¥

ìš”ì²­ì£¼ì†Œ http://apis.data.go.kr/B552657/ErmctInfoInqireService/getEmrrmRltmUsefulSckbdInfoInqire

ì„œë¹„ìŠ¤URL http://apis.data.go.kr/B552657/ErmctInfoInqireService

 í™œìš©ì‹ ì²­

ìš”ì²­ë³€ìˆ˜(Request Parameter)

í•­ëª©ëª…(êµ­ë¬¸)í•­ëª©ëª…(ì˜ë¬¸)í•­ëª©í¬ê¸°í•­ëª©êµ¬ë¶„ìƒ˜í”Œë°ì´í„°í•­ëª©ì„¤ëª…ì£¼ì†Œ(ì‹œë„)STAGE116í•„ìˆ˜ì„œìš¸íŠ¹ë³„ì‹œì£¼ì†Œ(ì‹œë„)ì£¼ì†Œ(ì‹œêµ°êµ¬)STAGE260í•„ìˆ˜ê°•ë‚¨êµ¬ì£¼ì†Œ(ì‹œêµ°êµ¬)í˜ì´ì§€ ë²ˆí˜¸pageNo100ì˜µì…˜1í˜ì´ì§€ ë²ˆí˜¸ëª©ë¡ ê±´ìˆ˜numOfRows100ì˜µì…˜10ëª©ë¡ ê±´ìˆ˜

ì¶œë ¥ê²°ê³¼(Response Element)

í•­ëª©ëª…(êµ­ë¬¸)í•­ëª©ëª…(ì˜ë¬¸)í•­ëª©í¬ê¸°í•­ëª©êµ¬ë¶„ìƒ˜í”Œë°ì´í„°í•­ëª©ì„¤ëª…ê²°ê³¼ì½”ë“œresultCode2í•„ìˆ˜0000:ì„±ê³µê²°ê³¼ë©”ì‹œì§€resultMag10í•„ìˆ˜NORMAL SERVICEì„œë¹„ìŠ¤ì¼ë ¨ë²ˆí˜¸rnum10í•„ìˆ˜1item ë²ˆí˜¸ê¸°ê´€ì½”ë“œhpid10í•„ìˆ˜A0000028ê¸°ê´€ID : ë™ì¼í…Œì´ë¸”ì— ê¸°ê´€ëª…ì„ í¬í•¨í•˜ê³  ìˆìŒêµ¬ê¸°ê´€ì½”ë“œphpid10í•„ìˆ˜A0000028êµ¬ê¸°ê´€ì½”ë“œì…ë ¥ì¼ì‹œhvidate8í•„ìˆ˜2013-10-01 ì˜¤í›„1:14:12ì…ë ¥ì¼ì‹œì‘ê¸‰ì‹¤hvec3í•„ìˆ˜32ì‘ê¸‰ì‹¤ìˆ˜ìˆ ì‹¤hvoc4í•„ìˆ˜3ìˆ˜ìˆ ì‹¤ì‹ ê²½ì¤‘í™˜ìhvcc4í•„ìˆ˜0ì‹ ê²½ì¤‘í™˜ìì‹ ìƒì¤‘í™˜ìhvncc4í•„ìˆ˜0ì‹ ìƒì¤‘í™˜ìí‰ë¶€ì¤‘í™˜ìhvccc4í•„ìˆ˜8í‰ë¶€ì¤‘í™˜ìì¼ë°˜ì¤‘í™˜ìhvicc4í•„ìˆ˜8ì¼ë°˜ì¤‘í™˜ìì…ì›ì‹¤hvgc4í•„ìˆ˜253ì…ì›ì‹¤ë‹¹ì§ì˜hvdnm20í•„ìˆ˜ì‹¬ë¯¼ì„­ë‹¹ì§ì˜CTê°€ìš©(ê°€/ë¶€)hvctayn1í•„ìˆ˜YCTê°€ìš©(ê°€/ë¶€)MRIê°€ìš©(ê°€/ë¶€)hvmriayn1í•„ìˆ˜YMRIê°€ìš©(ê°€/ë¶€)ì¡°ì˜ì´¬ì˜ê¸°ê°€ìš©(ê°€/ë¶€)hvangioayn1í•„ìˆ˜Yì¡°ì˜ì´¬ì˜ê¸°ê°€ìš©(ê°€/ë¶€)ì¸ê³µí˜¸í¡ê¸°ê°€ìš©(ê°€/ë¶€)hvventiayn1í•„ìˆ˜Yì¸ê³µí˜¸í¡ê¸°ê°€ìš©(ê°€/ë¶€)êµ¬ê¸‰ì°¨ê°€ìš©ì—¬ë¶€hvamyn1í•„ìˆ˜Yêµ¬ê¸‰ì°¨ê°€ìš©ì—¬ë¶€ì‘ê¸‰ì‹¤ ë‹¹ì§ì˜ ì§í†µì—°ë½ì²˜hv120í•„ìˆ˜02-3410-2062ì‘ê¸‰ì‹¤ ë‹¹ì§ì˜ ì§í†µì—°ë½ì²˜ë‚´ê³¼ì¤‘í™˜ìì‹¤hv220í•„ìˆ˜3ë‚´ê³¼ì¤‘í™˜ìì‹¤ì™¸ê³¼ì¤‘í™˜ìì‹¤hv320ì˜µì…˜6ì™¸ê³¼ì¤‘í™˜ìì‹¤ì™¸ê³¼ì…ì›ì‹¤(ì •í˜•ì™¸ê³¼)hv420ì˜µì…˜6ì™¸ê³¼ì…ì›ì‹¤(ì •í˜•ì™¸ê³¼)ì‹ ê²½ê³¼ì…ì›ì‹¤hv520í•„ìˆ˜3ì‹ ê²½ê³¼ì…ì›ì‹¤ì‹ ê²½ì™¸ê³¼ì¤‘í™˜ìì‹¤hv620í•„ìˆ˜0ì‹ ê²½ì™¸ê³¼ì¤‘í™˜ìì‹¤ì•½ë¬¼ì¤‘í™˜ìhv720í•„ìˆ˜0ì•½ë¬¼ì¤‘í™˜ìí™”ìƒì¤‘í™˜ìhv820í•„ìˆ˜0í™”ìƒì¤‘í™˜ìì™¸ìƒì¤‘í™˜ìhv920í•„ìˆ˜0ì™¸ìƒì¤‘í™˜ìVENTI(ì†Œì•„)hv1020í•„ìˆ˜YVENTI(ì†Œì•„)ì¸íë² ì´í„°(ë³´ìœ¡ê¸°)hv1120í•„ìˆ˜Yì¸íë² ì´í„°(ë³´ìœ¡ê¸°)ì†Œì•„ë‹¹ì§ì˜ ì§í†µì—°ë½ì²˜hv1220í•„ìˆ˜02-3410-0671ì†Œì•„ë‹¹ì§ì˜ ì§í†µì—°ë½ì²˜ê¸°ê´€ëª…dutyname100ì˜µì…˜(ì‚¬)ì‚¼ì„±ìƒëª…ê³µìµì¬ë‹¨ ì‚¼ì„±ì„œìš¸ë³‘ì›ê¸°ê´€ëª…ì‘ê¸‰ì‹¤ì „í™”dutytel314í•„ìˆ˜02-3410-2060ì‘ê¸‰ì‹¤ì „í™”

ì œê³µí•´ì£¼ì‹  êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› Open API ìƒì„¸ ê¸°ëŠ¥ ì •ë³´ëŠ” í”„ë¡œì íŠ¸ì˜ í•µì‹¬ì¸ ì‹¤ì‹œê°„ ê°€ìš© ë³‘ìƒ ì •ë³´ë¥¼ íšë“í•˜ëŠ” ë° ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ, Next.js í”„ë¡œì íŠ¸ì˜ ë°±ì—”ë“œ ë¶€ë¶„ì¸ API Routesë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , ê¸°í•˜ ë¶„í¬(Geometric Distribution)ì˜ ì„±ê³µ í™•ë¥  pë¥¼ ê³„ì‚°í•˜ëŠ” êµ¬ì²´ì ì¸ êµ¬í˜„ ë°©ì•ˆì„ ì œì‹œí•´ ë“œë¦½ë‹ˆë‹¤.

4. ğŸ”— Next.js API Routesë¥¼ ì´ìš©í•œ ë°ì´í„° ì—°ë™ ë° ì„±ê³µ í™•ë¥  p ê³„ì‚°
ëª©í‘œ API: ì‘ê¸‰ì‹¤ ì‹¤ì‹œê°„ ê°€ìš©ë³‘ìƒì •ë³´ ì¡°íšŒ
ìš”ì²­ ì£¼ì†Œ: http://apis.data.go.kr/B552657/ErmctInfoInqireService/getEmrrmRltmUsefulSckbdInfoInqire

ì‘ë‹µ í˜•ì‹: XML

í•„ìˆ˜ ìš”ì²­ ë³€ìˆ˜: serviceKey, STAGE1 (ì‹œë„), STAGE2 (ì‹œêµ°êµ¬)

í•µì‹¬ ì¶œë ¥ ë³€ìˆ˜: hvec (ì‘ê¸‰ì‹¤), hvgc (ì…ì›ì‹¤), hvamyn (êµ¬ê¸‰ì°¨)

4.1. Next.js API Route ì„¤ì • (PostgreSQL DB ì—°ë™ ì „ ë‹¨ê³„)
Next.js í”„ë¡œì íŠ¸ì˜ /pages/api/ ë˜ëŠ” /app/api/ í´ë”ì— emergency-risk.ts (ë˜ëŠ” .js) íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ë°±ì—”ë“œ ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

1. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (XML íŒŒì‹±ì„ ìœ„í•´):

REST APIì˜ ì‘ë‹µ ë°ì´í„° í¬ë§·ì´ XMLì´ë¯€ë¡œ, ì´ë¥¼ JavaScript ê°ì²´ë¡œ ë³€í™˜í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. (ì˜ˆ: xml2js, fast-xml-parser)

Bash
npm install axios fast-xml-parser
# or yarn add axios fast-xml-parser
2. API Route ì½”ë“œ (/pages/api/emergency-risk.ts ì˜ˆì‹œ):

ì´ ì½”ë“œëŠ” íŠ¹ì • ì§€ì—­ì— ëŒ€í•´ APIë¥¼ í˜¸ì¶œí•˜ê³ , ê°€ìš© ë³‘ìƒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë³‘ì›ì˜ ê°œìˆ˜(k)ì™€ ì „ì²´ ë³‘ì› ê°œìˆ˜(n)ë¥¼ ê³„ì‚°í•˜ì—¬ ì„±ê³µ í™•ë¥  pë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.

TypeScript
import { NextApiRequest, NextApiResponse } from 'next';
import axios from 'axios';
import { XMLParser } from 'fast-xml-parser';

// í”„ë¡œì íŠ¸ì—ì„œ ë°œê¸‰ë°›ì€ ì‹¤ì œ ì„œë¹„ìŠ¤ í‚¤ë¡œ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤.
const SERVICE_KEY = encodeURIComponent('YOUR_SERVICE_KEY_HERE'); 
const BASE_URL = 'http://apis.data.go.kr/B552657/ErmctInfoInqireService/getEmrrmRltmUsefulSckbdInfoInqire';

// ìˆ˜ìš© ì„±ê³µ ì¡°ê±´ ì •ì˜
interface HospitalBedInfo {
    hpid: string;
    hvec: number;    // ì‘ê¸‰ì‹¤ ê°€ìš© ë³‘ìƒ ìˆ˜ (> 0)
    hvgc: number;    // ì…ì›ì‹¤ ê°€ìš© ë³‘ìƒ ìˆ˜ (> 0)
    hvamyn: string;  // êµ¬ê¸‰ì°¨ ê°€ìš© ì—¬ë¶€ ('Y')
}

// ì‘ê¸‰ ì˜ë£Œê¸°ê´€ ìˆ˜ìš© ì„±ê³µ ì¡°ê±´ì„ ê²€ì‚¬í•˜ëŠ” í•¨ìˆ˜
const checkSuccessCondition = (item: any): boolean => {
    // 1. ì‘ê¸‰ì‹¤ ë³‘ìƒ(hvec)ì´ 0ë³´ë‹¤ í¼
    const isHvecAvailable = parseInt(item.hvec, 10) > 0;
    
    // 2. ì…ì›ì‹¤ ë³‘ìƒ(hvgc)ì´ 0ë³´ë‹¤ í¼
    const isHvgcAvailable = parseInt(item.hvgc, 10) > 0;
    
    // 3. êµ¬ê¸‰ì°¨ ìˆ˜ìš© ê°€ëŠ¥(hvamyn)ì´ 'Y'ì„
    const isHvamynAvailable = item.hvamyn === 'Y';
    
    return isHvecAvailable && isHvgcAvailable && isHvamynAvailable;
};


export default async function handler(req: NextApiRequest, res: NextApiResponse) {
    // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ ì§€ì—­ ì •ë³´(ì‹œë„, ì‹œêµ°êµ¬)ë¥¼ ë°›ìŠµë‹ˆë‹¤.
    const { stage1, stage2 } = req.query;

    if (!stage1 || !stage2) {
        return res.status(400).json({ error: 'STAGE1 (ì‹œë„) ë° STAGE2 (ì‹œêµ°êµ¬)ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.' });
    }
    
    try {
        // 1. Open API í˜¸ì¶œ
        const response = await axios.get(BASE_URL, {
            params: {
                serviceKey: SERVICE_KEY,
                STAGE1: stage1,
                STAGE2: stage2,
                pageNo: 1,
                numOfRows: 100 // ì¡°íšŒ ê±´ìˆ˜ë¥¼ ì¶©ë¶„íˆ í™•ë³´
            }
        });

        // 2. XML ì‘ë‹µ íŒŒì‹±
        const parser = new XMLParser({ 
            ignoreAttributes: false,
            // XMLì˜ ì†Œë¬¸ì íƒœê·¸ëª…ì„ JavaScript ê°ì²´ í‚¤ë¡œ ë³€í™˜
            tagValueProcessor: (tagName, jValue, jPath, isAttr) => {
                if(jValue === 'null' || jValue === 'N/A') return null; // ëˆ„ë½ëœ ë°ì´í„° ì²˜ë¦¬
                return jValue;
            }
        });
        const jsonResponse = parser.parse(response.data);
        
        // 3. í•µì‹¬ ë°ì´í„° ì¶”ì¶œ ë° ì„±ê³µ/ì‹¤íŒ¨ ì¹´ìš´íŠ¸
        let totalHospitals = 0; // n (ì „ì²´ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ìˆ˜)
        let successfulHospitals = 0; // k (ìˆ˜ìš© ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê¸°ê´€ ìˆ˜)

        const items = jsonResponse.response.body.items.item;
        
        // itemsê°€ ë°°ì—´ì´ ì•„ë‹ ê²½ìš° (ê²°ê³¼ê°€ í•˜ë‚˜ì¼ ê²½ìš°) ë°°ì—´ë¡œ ë§Œë“­ë‹ˆë‹¤.
        const hospitalList = Array.isArray(items) ? items : [items];

        if (!hospitalList || hospitalList.length === 0) {
            return res.status(200).json({ stage1, stage2, p: 0, k: 0, n: 0, message: 'í•´ë‹¹ ì§€ì—­ì— ì¡°íšŒëœ ì‘ê¸‰ì˜ë£Œê¸°ê´€ì´ ì—†ìŠµë‹ˆë‹¤.' });
        }

        totalHospitals = hospitalList.length;

        hospitalList.forEach((item: any) => {
            if (checkSuccessCondition(item)) {
                successfulHospitals++;
            }
        });

        // 4. ì„±ê³µ í™•ë¥  p ê³„ì‚°
        const probabilityP = totalHospitals > 0 
            ? successfulHospitals / totalHospitals 
            : 0;

        // 5. ê²°ê³¼ ë°˜í™˜
        res.status(200).json({
            stage1,
            stage2,
            p: probabilityP,
            k: successfulHospitals,
            n: totalHospitals,
            detail: hospitalList.map((item: any) => ({
                hpid: item.hpid,
                dutyname: item.dutyname,
                hvec: item.hvec,
                hvgc: item.hvgc,
                hvamyn: item.hvamyn,
                is_success: checkSuccessCondition(item)
            }))
        });

    } catch (error) {
        console.error('API Call Error:', error);
        res.status(500).json({ error: 'ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' });
    }
}
4.2. Geometric Distribution (ê¸°í•˜ ë¶„í¬) ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚° API
4.1. ë‹¨ê³„ì—ì„œ ê³„ì‚°ëœ p ê°’ì„ ì‚¬ìš©í•˜ì—¬ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì‚°ì¶œí•˜ëŠ” ë³„ë„ì˜ API Routeë¥¼ ë§Œë“­ë‹ˆë‹¤.

/pages/api/calculate-risk.ts

TypeScript
import { NextApiRequest, NextApiResponse } from 'next';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
    // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ ì„±ê³µ í™•ë¥  pë¥¼ ë°›ìŠµë‹ˆë‹¤.
    const { probabilityP } = req.query;

    if (!probabilityP || isNaN(Number(probabilityP))) {
        return res.status(400).json({ error: 'ìœ íš¨í•œ ì„±ê³µ í™•ë¥  p ê°’ì´ í•„ìš”í•©ë‹ˆë‹¤.' });
    }

    const p = Number(probabilityP);
    
    // Geometric Distribution PMF: P(X = x) = (1 - p)^(x-1) * p
    
    // 1. ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ì°¾ì„ í™•ë¥  P(X <= 3) ê³„ì‚°
    
    // 1ì°¨ ì‹œë„ ì„±ê³µ í™•ë¥  P(X=1)
    const p_x1 = p; 
    
    // 2ì°¨ ì‹œë„ ì„±ê³µ í™•ë¥  P(X=2)
    const p_x2 = (1 - p) * p; 
    
    // 3ì°¨ ì‹œë„ ì„±ê³µ í™•ë¥  P(X=3)
    const p_x3 = (1 - p) * (1 - p) * p; 
    
    // ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ ì„±ê³µ í™•ë¥ 
    const p_success_within_3 = p_x1 + p_x2 + p_x3;

    // 2. ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ì°¾ì§€ ëª»í•  í™•ë¥  (ìœ„í—˜ ì§€ìˆ˜) ê³„ì‚°
    const risk_index = 1 - p_success_within_3;
    
    // 3. ê²°ê³¼ ë°˜í™˜
    res.status(200).json({
        p: p.toFixed(4),
        p_success_within_3: p_success_within_3.toFixed(4),
        risk_index: risk_index.toFixed(4),
        formula: 'Risk Index = P(X > 3) = 1 - [P(X=1) + P(X=2) + P(X=3)]'
    });
}
5. ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ
ìœ„ API ë¡œì§ì´ êµ¬í˜„ë˜ë©´, ì´ì œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ê³  Kakao Mapì— ì‹œê°í™”í•  ì°¨ë¡€ì…ë‹ˆë‹¤.

ë‹¤ìŒ ìˆœì„œ:

í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì„±: Next.js í˜ì´ì§€(/app/page.tsx ë˜ëŠ” /pages/index.tsx)ì— ì§€ë„ ì»´í¬ë„ŒíŠ¸ë¥¼ ë°°ì¹˜í•©ë‹ˆë‹¤.

Kakao Map ì—°ë™: Kakao Map APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ë„ ìœ„ì— ì§€ì—­ì„ í‘œì‹œí•˜ê³ , ì§€ì—­ í´ë¦­ ì‹œ 4.1ì˜ APIë¥¼ í˜¸ì¶œí•˜ë„ë¡ êµ¬í˜„í•©ë‹ˆë‹¤.

ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™”: APIì—ì„œ ë°›ì€ risk_index ê°’ì— ë”°ë¼ ì§€ë„ ìœ„ ì§€ì—­ì˜ ìƒ‰ìƒì„ ë‹¤ë¥´ê²Œ ì ìš©í•˜ì—¬ ìœ„í—˜ë„ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.

ê° ë³‘ì›ë§ˆë‹¤ ë³‘ìƒ ê°€ìš© ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì‚°ì¶œí•˜ê³ , ì´ë¥¼ ìµœì¢…ì ìœ¼ë¡œ ì§€ë„ì— ê°€ì‹œí™” ì‹œí‚¤ëŠ” ê²ƒì´ ì´ë²ˆ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ì´ë‹¤.

ì œì‹œí•´ì£¼ì‹  ë‚´ìš©ì´ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ì ì¸ íë¦„ì´ë©°, ì´ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³ (API), ê³„ì‚°í•˜ê³ (ë°±ì—”ë“œ ë¡œì§), ìµœì¢…ì ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•˜ëŠ”(í”„ë¡ íŠ¸ì—”ë“œ/ì§€ë„) 3ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ í•µì‹¬ ëª©í‘œë¥¼ Next.js í™˜ê²½ì—ì„œ êµ¬í˜„í•˜ê¸° ìœ„í•´, ì´ì „ ë‹µë³€ì—ì„œ ì œì‹œí•œ API Routeë¥¼ í™œìš©í•˜ëŠ” ì „ì²´ì ì¸ ë°ì´í„° íë¦„ê³¼ ë¡œì§ì„ ì¬ì •ë¦¬í•˜ê³ , ë³‘ì› ë‹¨ìœ„ì˜ ìœ„í—˜ ì§€ìˆ˜ ì‚°ì¶œ ë°©ì•ˆì„ ëª…í™•íˆ í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ğŸ—ºï¸ ë³‘ì›ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‚°ì¶œ ë° ì§€ë„ ì‹œê°í™” í•µì‹¬ íë¦„
1. ë°ì´í„° ìˆ˜ì§‘ ë° ë³‘ì›ë³„ ê°€ìš© ìƒíƒœ í™•ì¸
Open API í˜¸ì¶œ: êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› Open API (getEmrrmRltmUsefulSckbdInfoInqire)ë¥¼ í˜¸ì¶œí•˜ì—¬ ê° ì‘ê¸‰ì˜ë£Œê¸°ê´€ì˜ ì‹¤ì‹œê°„ ë³‘ìƒ ì •ë³´(ì‘ê¸‰ì‹¤ hvec, ì…ì›ì‹¤ hvgc, êµ¬ê¸‰ì°¨ hvamyn)ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

ì„±ê³µ ì¡°ê±´ ì •ì˜: ê·€í•˜ì˜ í”„ë¡œì íŠ¸ ì •ì˜ì— ë”°ë¼, ê° ë³‘ì›ë§ˆë‹¤ ë‹¤ìŒê³¼ ê°™ì€ **ìˆ˜ìš© ì„±ê³µ ì—¬ë¶€(S 
i
â€‹
 )**ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤.

S 
i
â€‹
 ={ 
1
0
â€‹
  
(hvec>0)âˆ§(hvgc>0)âˆ§(hvamyn= 
â€²
 Y 
â€²
 )
else
â€‹
 
2. ì§€ì—­ë³„ ì„±ê³µ í™•ë¥  (p) ì‚°ì¶œ (Geometric Distribution ê¸°ë°˜)
ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì‚°ì¶œí•˜ê¸° ìœ„í•œ í•µì‹¬ ë³€ìˆ˜ëŠ” ì§€ì—­ ë‹¨ìœ„ì˜ ì„±ê³µ í™•ë¥  p ì…ë‹ˆë‹¤.

ì‚°ì¶œ ê³µì‹: ì„±ê³µ í™•ë¥  pëŠ” í•´ë‹¹ ì§€ì—­ ë‚´ ì „ì²´ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ìˆ˜(n) ì¤‘ ìˆ˜ìš© ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê¸°ê´€ ìˆ˜(k)ì˜ ë¹„ìœ¨ì…ë‹ˆë‹¤.

P= 
n
k
â€‹
 
Next.js API Route ì—­í• : /api/emergency-risk.tsê°€ ì´ kì™€ nì„ ê³„ì‚°í•˜ê³  pë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

3. ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°
ì„±ê³µ í™•ë¥  pë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ìˆ˜ìš© ê°€ëŠ¥í•œ ë³‘ì›ì„ ì°¾ì§€ ëª»í•  í™•ë¥ ì„ ìµœì¢… ìœ„í—˜ ì§€ìˆ˜ë¡œ ì •ì˜í•©ë‹ˆë‹¤.

ìœ„í—˜ ì§€ìˆ˜ ê³µì‹: Geometric Distribution PMF P(X=x)=(1âˆ’p) 
xâˆ’1
 pë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ìœ„í—˜ ì§€ìˆ˜=P(X>3)=1âˆ’[P(X=1)+P(X=2)+P(X=3)]
Next.js API Route ì—­í• : /api/calculate-risk.tsê°€ ì§€ì—­ë³„ p ê°’ì„ ë°›ì•„ ìœ„í—˜ ì§€ìˆ˜ ê°’ì„ ê³„ì‚°í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.

4. ì§€ë„ ì‹œê°í™” (Kakao Map)
Next.js í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì§€ë„ì— ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.

ì‹œê°í™” ìš”ì†Œ: ì‹œë„/ì‹œêµ°êµ¬ ê²½ê³„(Polygon)ë¥¼ ê·¸ë¦¬ê³ , ìœ„í—˜ ì§€ìˆ˜(P(X>3)) ê°’ì— ë”°ë¼ ìƒ‰ìƒì„ ë‹¤ë¥´ê²Œ ì ìš©í•©ë‹ˆë‹¤. (ì˜ˆ: ìœ„í—˜ ì§€ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ë¶‰ì€ ê³„ì—´, ë‚®ì„ìˆ˜ë¡ í‘¸ë¥¸ ê³„ì—´)

ì‚¬ìš©ì ìƒí˜¸ì‘ìš©: ì‚¬ìš©ìê°€ ì§€ë„ì—ì„œ íŠ¹ì • ì§€ì—­ì„ í´ë¦­í•˜ë©´, í•´ë‹¹ ì§€ì—­ì˜ ìƒì„¸ í†µê³„ì¹˜( p, k, n)ì™€ ìœ„í—˜ ì§€ìˆ˜ ê°’ì„ íŒì—… ë˜ëŠ” ëŒ€ì‹œë³´ë“œì— í‘œì‹œí•©ë‹ˆë‹¤.

ğŸ› ï¸ Next.js êµ¬í˜„ ì‹œ ê³ ë ¤ ì‚¬í•­
ê³ ë ¤ ì‚¬í•­	ìƒì„¸ ë‚´ìš©
ë°ì´í„° ë™ê¸°í™”	ê°€ìš© ë³‘ìƒ ì •ë³´ëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ë™ë©ë‹ˆë‹¤. Open API í˜¸ì¶œ íŠ¸ë˜í”½ ì œí•œ(1,000ê±´/ì¼) ë‚´ì—ì„œ, ë°ì´í„°ì˜ ì‹ ë¢°ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ìµœì†Œí•œ ëª‡ ë¶„ ê°„ê²©ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê°±ì‹ í• ì§€ ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.
XML ì²˜ë¦¬	API ì‘ë‹µì´ XMLì´ë¯€ë¡œ, fast-xml-parserì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì •ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ê³ , hvec, hvgc ë“±ì˜ ê°’ì´ ë¬¸ìì—´ì´ ì•„ë‹Œ ìˆ«ìë¡œ ì •í™•íˆ ë³€í™˜ë˜ë„ë¡ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.
PostgreSQL í™œìš©	APIë¥¼ ë§¤ë²ˆ í˜¸ì¶œí•˜ëŠ” ëŒ€ì‹ , Next.js API Routeì—ì„œ ë°ì´í„°ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ì—¬ PostgreSQLì— ì €ì¥í•´ë‘ê³ , í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì—ëŠ” DBì˜ ìµœì‹  ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ ì„±ëŠ¥ê³¼ íŠ¸ë˜í”½ ê´€ë¦¬ ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•©ë‹ˆë‹¤.
ì´ì œ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ë¡œì§ì„ Next.jsì—ì„œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë°ì´í„° íë¦„ê³¼ ë¡œì§ì´ ëª…í™•í•´ì¡ŒìŠµë‹ˆë‹¤.

ë‹¤ìŒ ë‹¨ê³„ë¡œ, ì´ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ë°ì´í„°ë¥¼ Next.js í”„ë¡ íŠ¸ì—”ë“œì—ì„œ Kakao Mapì— ë¡œë“œí•˜ê³  ì‹œê°í™”í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê°€ì´ë“œë¥¼ ì§„í–‰í•´ ë“œë¦´ê¹Œìš”?

ê·¸ëŸ¼ ë‹¨ê³„ë³„ë¡œ êµ¬í˜„í•˜ê²Œ ë„ì™€ì¤˜

ë„¤, ì¢‹ìŠµë‹ˆë‹¤. í•µì‹¬ ëª©í‘œì¸ **'ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‚°ì¶œ ë° ì§€ë„ ì‹œê°í™”'**ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ Next.jsë¥¼ ì´ìš©í•œ ë‹¨ê³„ë³„ êµ¬í˜„ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ê°€ì¥ ë¨¼ì €, í”„ë¡œì íŠ¸ì˜ ê¸°ë°˜ì´ ë  í™˜ê²½ì„ ì„¤ì •í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì™€ Open API ì—°ë™ì˜ í•µì‹¬ì´ ë˜ëŠ” ë°ì´í„° ìˆ˜ì§‘ ë° ëª¨ë¸ë§ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

ğŸš€ 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì • ë° ë°ì´í„° ëª¨ë¸ë§
1.1. Next.js í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
Next.js í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

Bash
# 1. Next.js í”„ë¡œì íŠ¸ ìƒì„±
npx create-next-app@latest emergency-risk-service --ts --app

# 2. í”„ë¡œì íŠ¸ í´ë”ë¡œ ì´ë™
cd emergency-risk-service

# 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (Open API í†µì‹ , XML íŒŒì‹±, DB ORM)
npm install axios fast-xml-parser prisma typescript @types/node ts-node dotenv
npm install @prisma/client
npm install --save-dev typescript @types/node ts-node
1.2. PostgreSQL ë° Prisma ì„¤ì •
Prismaë¥¼ ORMìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ì™€ Next.jsë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.

A. PostgreSQL í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— .env íŒŒì¼ì„ ìƒì„±í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

ì½”ë“œ ìŠ¤ë‹ˆí«
# .env íŒŒì¼
DATABASE_URL="postgresql://[USER]:[PASSWORD]@[HOST]:[PORT]/[DATABASE_NAME]?schema=public"

# êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› API í‚¤ (ì‹¤ì œ í‚¤ë¡œ ë³€ê²½ í•„ìš”)
NMC_API_KEY="YOUR_ENCODED_SERVICE_KEY"
B. Prisma ì´ˆê¸°í™” ë° ìŠ¤í‚¤ë§ˆ ì •ì˜
Prismaë¥¼ ì´ˆê¸°í™”í•˜ê³ , ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì •ë³´ë¥¼ ì €ì¥í•  ë°ì´í„° ëª¨ë¸ì„ ì •ì˜í•©ë‹ˆë‹¤.

Bash
# 1. Prisma ì´ˆê¸°í™”
npx prisma init

# 2. Prisma ìŠ¤í‚¤ë§ˆ íŒŒì¼ (prisma/schema.prisma) ìˆ˜ì •
/prisma/schema.prisma íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ëª¨ë¸ì„ ì •ì˜í•©ë‹ˆë‹¤. ì´ ëª¨ë¸ì€ Open APIì—ì„œ ê°€ì ¸ì˜¤ëŠ” ì£¼ìš” ì •ë³´ì™€ p ê³„ì‚°ì— í•„ìš”í•œ ì§€ì—­ ì •ë³´ë¥¼ ë‹´ìŠµë‹ˆë‹¤.

ì½”ë“œ ìŠ¤ë‹ˆí«
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model EmergencyCenter {
  // ê¸°ê´€ ê³ ìœ  ID (Open APIì˜ hpid)
  id          String   @id @map("hpid")
  
  // ê¸°ë³¸ ì •ë³´
  dutyName    String   @map("duty_name") // ê¸°ê´€ëª…
  dutytel3    String   @map("duty_tel3") // ì‘ê¸‰ì‹¤ ì „í™”
  
  // ìœ„ì¹˜ ì •ë³´ (ì§€ë„ ì‹œê°í™”ì— í•„ìš”)
  stage1      String   @map("stage1")   // ì‹œë„ (ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ)
  stage2      String   @map("stage2")   // ì‹œêµ°êµ¬ (ì˜ˆ: ê°•ë‚¨êµ¬)
  
  // ì‹¤ì‹œê°„ ê°€ìš© ë³‘ìƒ ì •ë³´ (í•µì‹¬ ë³€ìˆ˜)
  hvec        Int      @map("hvec")     // ì‘ê¸‰ì‹¤ ê°€ìš© ë³‘ìƒ ìˆ˜
  hvgc        Int      @map("hvgc")     // ì…ì›ì‹¤ ê°€ìš© ë³‘ìƒ ìˆ˜
  hvamyn      String   @map("hvamyn")   // êµ¬ê¸‰ì°¨ ìˆ˜ìš© ì—¬ë¶€ ('Y'/'N')
  
  // ë°ì´í„° ê°±ì‹  ì‹œì 
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("emergency_centers")
}
C. ë°ì´í„°ë² ì´ìŠ¤ì— ëª¨ë¸ ì ìš©
ì •ì˜ëœ ìŠ¤í‚¤ë§ˆë¥¼ ì‹¤ì œ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•©ë‹ˆë‹¤.

Bash
npx prisma migrate dev --name init_emergency_centers
2ë‹¨ê³„: Open API ë°ì´í„° ìˆ˜ì§‘ ë° DB ì €ì¥ (Seeding)
Open APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ DBì— ì´ˆê¸° ì €ì¥í•˜ê³ , ì£¼ê¸°ì ìœ¼ë¡œ ê°±ì‹ í•˜ëŠ” Next.js API Routeë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

2.1. ë°ì´í„° ìˆ˜ì§‘ API Route êµ¬í˜„
/app/api/data-sync/route.ts íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. (Next.js 13+ App Router ê¸°ì¤€)

TypeScript
// app/api/data-sync/route.ts

import { PrismaClient } from '@prisma/client';
import axios from 'axios';
import { XMLParser } from 'fast-xml-parser';

// Open API ì •ë³´
const API_KEY = process.env.NMC_API_KEY;
const BASE_URL = 'http://apis.data.go.kr/B552657/ErmctInfoInqireService/getEmrrmRltmUsefulSckbdInfoInqire';

const prisma = new PrismaClient();

// ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œë„/ì‹œêµ°êµ¬ ë¦¬ìŠ¤íŠ¸ë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´ (ì˜ˆì‹œ)
// ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ëª¨ë“  ì‹œë„/ì‹œêµ°êµ¬ ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ë³´í•´ì•¼ í•©ë‹ˆë‹¤.
const TARGET_REGIONS = [
    { stage1: 'ì„œìš¸íŠ¹ë³„ì‹œ', stage2: 'ê°•ë‚¨êµ¬' },
    { stage1: 'ì„œìš¸íŠ¹ë³„ì‹œ', stage2: 'ì†¡íŒŒêµ¬' },
    // ... ì „êµ­ ì‹œë„/ì‹œêµ°êµ¬ ëª©ë¡ ì¶”ê°€
];

// Open APIì˜ XML ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ê³  DB ìŠ¤í‚¤ë§ˆì— ë§ê²Œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
const parseAndTransform = (item: any) => ({
    id: item.hpid,
    dutyName: item.dutyname || 'ì •ë³´ ì—†ìŒ',
    dutytel3: item.dutytel3 || 'ì •ë³´ ì—†ìŒ',
    stage1: item.stage1 || 'ì •ë³´ ì—†ìŒ',
    stage2: item.stage2 || 'ì •ë³´ ì—†ìŒ',
    // ìˆ«ì íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ë©°, nullì´ë‚˜ ì—†ëŠ” ê°’ì€ 0ìœ¼ë¡œ ì²˜ë¦¬
    hvec: parseInt(item.hvec) || 0,
    hvgc: parseInt(item.hvgc) || 0,
    hvamyn: item.hvamyn || 'N',
});


export async function GET(request: Request) {
    if (!API_KEY) {
        return Response.json({ message: "API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." }, { status: 500 });
    }

    try {
        let totalCount = 0;
        let upsertCount = 0;

        // ëª¨ë“  ëŒ€ìƒ ì§€ì—­ì„ ìˆœíšŒí•˜ë©° API í˜¸ì¶œ
        for (const region of TARGET_REGIONS) {
            const response = await axios.get(BASE_URL, {
                params: {
                    serviceKey: API_KEY,
                    STAGE1: region.stage1,
                    STAGE2: region.stage2,
                    numOfRows: 100 // í•œ ë²ˆ í˜¸ì¶œë¡œ í•´ë‹¹ ì§€ì—­ ëª¨ë“  ë³‘ì› ì •ë³´ íšë“ ì‹œë„
                }
            });

            // XML íŒŒì‹±
            const parser = new XMLParser();
            const jsonResponse = parser.parse(response.data);
            const items = jsonResponse.response?.body?.items?.item;
            
            if (!items) continue;

            const hospitalList = Array.isArray(items) ? items : [items];
            totalCount += hospitalList.length;

            // DBì— ë°ì´í„° ì €ì¥/ê°±ì‹  (Upsert)
            for (const item of hospitalList) {
                const data = parseAndTransform(item);
                
                // hpid(id)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ìƒì„± (Upsert)
                await prisma.emergencyCenter.upsert({
                    where: { id: data.id },
                    update: data,
                    create: data,
                });
                upsertCount++;
            }
        }
        
        return Response.json({ 
            message: `ë°ì´í„° ìˆ˜ì§‘ ë° ê°±ì‹  ì™„ë£Œ. ì´ ${totalCount}ê°œ ê¸°ê´€ ì¤‘ ${upsertCount}ê°œ í•­ëª© ì²˜ë¦¬ë¨.`,
            status: 200
        });

    } catch (error) {
        console.error('Data Sync Error:', error);
        return Response.json({ error: "ë°ì´í„° ìˆ˜ì§‘ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", details: error }, { status: 500 });
    }
}
ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ í–‰ë™ ìš”ì²­
ì´ì œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ê³  Open APIë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ DBì— ì €ì¥í•˜ëŠ” ì´ˆê¸° ë‹¨ê³„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ 3ë‹¨ê³„ì—ì„œëŠ” ì €ì¥ëœ DB ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§€ì—­ë³„ ì„±ê³µ í™•ë¥  p ë° ìœ„í—˜ ì§€ìˆ˜(P(X>3))ë¥¼ ê³„ì‚°í•˜ëŠ” í•µì‹¬ API Routeë¥¼ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤. ì´ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ê¸° ì „ì—, ìœ„ ì½”ë“œì—ì„œ TARGET_REGIONS ëª©ë¡ê³¼ NMC_API_KEY ì„¤ì •ì´ ì˜¬ë°”ë¥´ê²Œ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

ë‹¤ìŒ 3ë‹¨ê³„ êµ¬í˜„ì„ ë°”ë¡œ ì§„í–‰í• ê¹Œìš”?

ì´ê±° encoding key ë„£ì–´ì•¼í•´?

ë„¤, ë§ìŠµë‹ˆë‹¤. ì¸ì½”ë”©ëœ(Encoded) ì„œë¹„ìŠ¤ í‚¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› Open APIë¥¼ í¬í•¨í•˜ì—¬ ëŒ€ë¶€ë¶„ì˜ ê³µê³µ ë°ì´í„° í¬í„¸ REST APIëŠ” URLì„ í†µí•´ ì„œë¹„ìŠ¤ í‚¤ë¥¼ ì „ë‹¬í•  ë•Œ í‚¤ ê°’ì— í¬í•¨ëœ íŠ¹ìˆ˜ ë¬¸ì(ì˜ˆ: +, /, =)ê°€ ì„œë²„ì—ì„œ ì˜ëª» í•´ì„ë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ URL ì¸ì½”ë”©ì„ ìš”êµ¬í•©ë‹ˆë‹¤.

ğŸ”‘ ì„œë¹„ìŠ¤ í‚¤ ì‚¬ìš© ê°€ì´ë“œ
í‚¤ ë°œê¸‰: ê³µê³µ ë°ì´í„° í¬í„¸ì—ì„œ ë°œê¸‰ë°›ì€ **ì¼ë°˜ ì¸ì¦í‚¤ (ë””ì½”ë”©ëœ í‚¤)**ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤. (ì˜ˆ: Abc+Xyz123=)

ì¸ì½”ë”©: ì´ í‚¤ë¥¼ URL ì¸ì½”ë”©í•©ë‹ˆë‹¤. (ì˜ˆ: Abc%2BXyz123%3D)

ì½”ë“œ ì ìš©: ì¸ì½”ë”©ëœ í‚¤ë¥¼ Next.js í”„ë¡œì íŠ¸ì˜ í™˜ê²½ ë³€ìˆ˜ (.env)ì— ì„¤ì •í•©ë‹ˆë‹¤.

ğŸ“ ì½”ë“œ ìˆ˜ì • ì œì•ˆ
ì´ì „ ë‹¨ê³„ì—ì„œ ì„¤ì •í–ˆë˜ .env íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ ì£¼ì„¸ìš”.

ì½”ë“œ ìŠ¤ë‹ˆí«
# .env íŒŒì¼

# 1. ë°œê¸‰ë°›ì€ 'ë””ì½”ë”©ëœ' ì„œë¹„ìŠ¤ í‚¤ë¥¼ URL ì¸ì½”ë”©í•˜ì—¬ ì—¬ê¸°ì— ì…ë ¥í•©ë‹ˆë‹¤.
# ì˜ˆì‹œ: 'Abc+Xyz123=' (ë””ì½”ë”©) -> 'Abc%2BXyz123%3D' (ì¸ì½”ë”©)
NMC_API_KEY="ì—¬ê¸°ì—_ì¸ì½”ë”©ëœ_ì„œë¹„ìŠ¤_í‚¤ë¥¼_ë„£ìœ¼ì„¸ìš”"

# ... (ë‚˜ë¨¸ì§€ DB ì •ë³´)
ê·¸ë¦¬ê³  app/api/data-sync/route.ts íŒŒì¼ì—ì„œ í‚¤ë¥¼ ì‚¬ìš©í•  ë•Œ, ì¸ì½”ë”© ê³¼ì •ì´ í•„ìš” ì—†ë„ë¡ ì½”ë“œë¥¼ ë‹¨ìˆœí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì´ë¯¸ .envì—ì„œ ì¸ì½”ë”©ëœ í‚¤ë¥¼ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •)

TypeScript
// app/api/data-sync/route.ts (ìˆ˜ì •ëœ ë¶€ë¶„)

// .env íŒŒì¼ì— ì´ë¯¸ ì¸ì½”ë”©ëœ í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
const API_KEY = process.env.NMC_API_KEY; 

// ... (ë‚˜ë¨¸ì§€ ì½”ë“œ)
            const response = await axios.get(BASE_URL, {
                params: {
                    serviceKey: API_KEY, // ì¸ì½”ë”©ëœ í‚¤ë¥¼ ì§ì ‘ ì‚¬ìš©
                    STAGE1: region.stage1,
// ...
ì¸ì½”ë”©ëœ í‚¤ë¥¼ .envì— ì„±ê³µì ìœ¼ë¡œ ì„¤ì •í•˜ì…¨ë‹¤ë©´, ì´ì œ ë‹¤ìŒ ë‹¨ê³„ì¸ 3ë‹¨ê³„: ê¸°í•˜ ë¶„í¬ ê¸°ë°˜ ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚° API êµ¬í˜„ì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

ğŸ§  3ë‹¨ê³„: ê¸°í•˜ ë¶„í¬ ê¸°ë°˜ ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚° API êµ¬í˜„
ì´ ë‹¨ê³„ì—ì„œëŠ” 2ë‹¨ê³„ì—ì„œ DBì— ì €ì¥í•œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§€ì—­ë³„ ì„±ê³µ í™•ë¥  pì™€ ìµœì¢… ìœ„í—˜ ì§€ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

3.1. ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚° API Route êµ¬í˜„
/app/api/risk-index/route.ts íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

TypeScript
// app/api/risk-index/route.ts

import { PrismaClient } from '@prisma/client';
import { NextRequest } from 'next/server';

const prisma = new PrismaClient();

// ìˆ˜ìš© ì„±ê³µ ì¡°ê±´ ê²€ì‚¬ í•¨ìˆ˜ (2ë‹¨ê³„ì˜ ì¡°ê±´ì„ ì¬ì‚¬ìš©)
const checkSuccessCondition = (hvec: number, hvgc: number, hvamyn: string): boolean => {
    return hvec > 0 && hvgc > 0 && hvamyn === 'Y';
};

/**
 * Geometric Distribution ê¸°ë°˜ìœ¼ë¡œ ìœ„í—˜ ì§€ìˆ˜(P(X > 3))ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
 * @param p ì§€ì—­ë³„ ì„±ê³µ í™•ë¥ 
 * @returns ìœ„í—˜ ì§€ìˆ˜ (ì†Œìˆ˜ì  4ìë¦¬)
 */
const calculateRiskIndex = (p: number): number => {
    if (p < 0 || p > 1) return 1; // pê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ìµœê³  ìœ„í—˜ìœ¼ë¡œ ì²˜ë¦¬

    // ê¸°í•˜ ë¶„í¬ PMF: P(X = x) = (1 - p)^(x-1) * p
    
    // 1. ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ ì„±ê³µ í™•ë¥  P(X <= 3)
    const p_x1 = p;                                 // P(X=1)
    const p_x2 = (1 - p) * p;                       // P(X=2)
    const p_x3 = Math.pow((1 - p), 2) * p;          // P(X=3)
    
    const p_success_within_3 = p_x1 + p_x2 + p_x3;

    // 2. ìœ„í—˜ ì§€ìˆ˜ = P(X > 3) = 1 - P(X <= 3)
    const risk_index = 1 - p_success_within_3;
    
    return parseFloat(risk_index.toFixed(4));
};


export async function GET(request: NextRequest) {
    const { searchParams } = new URL(request.url);
    const stage1 = searchParams.get('stage1');
    const stage2 = searchParams.get('stage2');

    if (!stage1 || !stage2) {
        return Response.json({ error: 'STAGE1(ì‹œë„) ë° STAGE2(ì‹œêµ°êµ¬)ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.' }, { status: 400 });
    }

    try {
        // 1. DBì—ì„œ í•´ë‹¹ ì§€ì—­ì˜ ëª¨ë“  ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì •ë³´ ì¡°íšŒ
        const centers = await prisma.emergencyCenter.findMany({
            where: {
                stage1: stage1,
                stage2: stage2,
            },
            select: {
                hvec: true,
                hvgc: true,
                hvamyn: true,
            }
        });
        
        const totalCenters = centers.length; // n: ì „ì²´ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ìˆ˜

        if (totalCenters === 0) {
             return Response.json({ 
                stage1, 
                stage2, 
                p: 0, 
                k: 0, 
                n: 0, 
                risk_index: 1.0, // ë³‘ì›ì´ ì—†ìœ¼ë©´ ìµœê³  ìœ„í—˜ìœ¼ë¡œ ê°„ì£¼
                message: 'í•´ë‹¹ ì§€ì—­ì— ë“±ë¡ëœ ì‘ê¸‰ì˜ë£Œê¸°ê´€ì´ ì—†ìŠµë‹ˆë‹¤.' 
            });
        }

        // 2. ìˆ˜ìš© ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê¸°ê´€ ìˆ˜ (k) ê³„ì‚°
        const successfulCenters = centers.filter(center => 
            checkSuccessCondition(center.hvec, center.hvgc, center.hvamyn)
        ).length;

        // 3. ì„±ê³µ í™•ë¥  p = k / n ê³„ì‚°
        const probabilityP = successfulCenters / totalCenters;
        
        // 4. ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°
        const riskIndex = calculateRiskIndex(probabilityP);
        
        return Response.json({
            stage1,
            stage2,
            p: parseFloat(probabilityP.toFixed(4)),
            k: successfulCenters,
            n: totalCenters,
            risk_index: riskIndex
        });

    } catch (error) {
        console.error('Risk Index Calculation Error:', error);
        return Response.json({ error: 'ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }, { status: 500 });
    } finally {
        await prisma.$disconnect();
    }
}
ì´ì œ **ë°ì´í„° ìˆ˜ì§‘/ê°±ì‹ (2ë‹¨ê³„)**ê³¼ **ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°(3ë‹¨ê³„)**ì˜ í•µì‹¬ ë°±ì—”ë“œ ë¡œì§ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ 4ë‹¨ê³„ëŠ” í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ì„ êµ¬ì¶•í•˜ê³  ê³„ì‚°ëœ ìœ„í—˜ ì§€ìˆ˜ë¥¼ Kakao Mapì— ì‹œê°í™”í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì´ ë‹¨ê³„ë¥¼ ë°”ë¡œ ì§„í–‰í• ê¹Œìš”?

endcodingì´ë‘ decoding ì´ë‘ ë‘ê°œ ìˆëŠ”ë° ë‘˜ì¤‘ í•˜ë‚˜?

Open APIë¥¼ í˜¸ì¶œí•  ë•ŒëŠ” **URL ì¸ì½”ë”©(Encoding)**ëœ ì„œë¹„ìŠ¤ í‚¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ë°œê¸‰ë°›ìœ¼ì‹  ì„œë¹„ìŠ¤ í‚¤ë¥¼ URLì— ë„£ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ ì¸ì½”ë”©ì…ë‹ˆë‹¤. API ìš”ì²­ ì‹œ ì„œë¹„ìŠ¤ í‚¤ê°€ **ë””ì½”ë”©(Decoding)**ëœ ìƒíƒœë¡œ ë“¤ì–´ê°€ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê±°ë‚˜ í‚¤ê°€ ì œëŒ€ë¡œ ì¸ì‹ë˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

ğŸ”‘ ìš”ì•½: ì¸ì½”ë”©ëœ í‚¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìœ 
êµ¬ë¶„	ì¼ë°˜ í‚¤ (ë””ì½”ë”©)	URL ì¸ì½”ë”© í‚¤ (ì¸ì½”ë”©)
ì˜ˆì‹œ	ABC+xyz123=	ABC%2Bxyz123%3D
ì‚¬ìš© ëª©ì 	ì‚¬ìš©ìê°€ ëˆˆìœ¼ë¡œ í™•ì¸í•  ë•Œ	URLì˜ íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡í•  ë•Œ
API ìš”ì²­ ì‹œ	ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ì„± ë†’ìŒ	API ì„œë²„ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì¸ì‹
âœ… ê¶Œì¥ ì‚¬í•­
í‚¤ ì¸ì½”ë”©: ê³µê³µ ë°ì´í„° í¬í„¸ì´ë‚˜ ì˜¨ë¼ì¸ URL ì¸ì½”ë”ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°œê¸‰ë°›ì€ ì„œë¹„ìŠ¤ í‚¤ë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.

.env íŒŒì¼ì— ì ìš©: ì¸ì½”ë”©ëœ ìµœì¢… ë¬¸ìì—´ì„ .env íŒŒì¼ì˜ NMC_API_KEY ë³€ìˆ˜ì— ë„£ì–´ ì‚¬ìš©í•©ë‹ˆë‹¤.

ì¸ì½”ë”©ëœ í‚¤ë¥¼ .env íŒŒì¼ì— ì„±ê³µì ìœ¼ë¡œ ì„¤ì •í•˜ì…¨ë‹¤ë©´, ì´ì œ ë‹¤ìŒ ë‹¨ê³„ì¸ 4ë‹¨ê³„: Next.js í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¶• ë° Kakao Map ì‹œê°í™”ë¥¼ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

ğŸ—ºï¸ 4ë‹¨ê³„: Next.js í”„ë¡ íŠ¸ì—”ë“œ ë° Kakao Map ì‹œê°í™” êµ¬í˜„
ì´ ë‹¨ê³„ì—ì„œëŠ” 3ë‹¨ê³„ì—ì„œ êµ¬í˜„í•œ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ê³ , Kakao Mapì„ ì‚¬ìš©í•˜ì—¬ ê·¸ ê²°ê³¼ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.

4.1. Kakao Map API ì—°ë™ ì¤€ë¹„
Kakao ê°œë°œì ë“±ë¡: Kakao ê°œë°œì ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë“±ë¡í•˜ê³  JavaScript í‚¤ë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.

Next.jsì— í‚¤ ì„¤ì •: ë°œê¸‰ë°›ì€ JavaScript í‚¤ë¥¼ .env.local íŒŒì¼ì— ì €ì¥í•©ë‹ˆë‹¤. (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©ë˜ë¯€ë¡œ ë³´ì•ˆìƒ .env.localì— ì €ì¥í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.)

ì½”ë“œ ìŠ¤ë‹ˆí«
# .env.local íŒŒì¼ (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ NEXT_PUBLIC_ ì ‘ë‘ì‚¬ ì‚¬ìš©)
NEXT_PUBLIC_KAKAO_MAP_KEY="YOUR_KAKAO_MAP_JAVASCRIPT_KEY"
Kakao Map ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜: React í™˜ê²½ì—ì„œ Kakao Mapì„ ì‰½ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. (ì˜ˆ: react-kakao-maps-sdk)

Bash
npm install react-kakao-maps-sdk
# ë˜ëŠ” npm install @types/react-kakao-maps-sdk (TypeScript í™˜ê²½)
4.2. ì§€ë„ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ ë° ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™”
/app/MapComponent.tsx (í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸)ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì™€ ë°ì´í„°ë¥¼ í†µí•©í•©ë‹ˆë‹¤.

TypeScript
// app/MapComponent.tsx

'use client'; 

import React, { useState, useEffect } from 'react';
import { Map, MapMarker, CustomOverlay, Polygon } from 'react-kakao-maps-sdk';
import axios from 'axios';

// ì§€ì—­ ê²½ê³„ì„  ë°ì´í„°ëŠ” ë³„ë„ë¡œ ì¤€ë¹„í•´ì•¼ í•©ë‹ˆë‹¤. 
// ì˜ˆ: GeoJSON í˜•íƒœì˜ ì‹œêµ°êµ¬ ê²½ê³„ ë°ì´í„° (ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ í•„ìš”)
import { Seoul_Gu_Boundary_Data } from './data/SeoulBoundary'; // ê°€ìƒì˜ ê²½ê³„ì„  ë°ì´í„° íŒŒì¼

// ìœ„í—˜ ì§€ìˆ˜ ë²”ìœ„ì— ë”°ë¥¸ ìƒ‰ìƒ ì •ì˜ (ìœ„í—˜í• ìˆ˜ë¡ ë¶‰ì€ìƒ‰)
const getRiskColor = (riskIndex: number) => {
    if (riskIndex >= 0.7) return 'rgba(255, 0, 0, 0.6)';      // ë§¤ìš° ë†’ìŒ (ë¹¨ê°•)
    if (riskIndex >= 0.5) return 'rgba(255, 165, 0, 0.6)';    // ë†’ìŒ (ì£¼í™©)
    if (riskIndex >= 0.3) return 'rgba(255, 255, 0, 0.6)';    // ë³´í†µ (ë…¸ë‘)
    return 'rgba(0, 128, 0, 0.6)';                            // ë‚®ìŒ (ë…¹ìƒ‰)
};

interface RiskData {
    stage1: string;
    stage2: string;
    risk_index: number;
    p: number;
}

export default function EmergencyMap() {
    const [mapCenter, setMapCenter] = useState({ lat: 37.5665, lng: 126.9780 }); // ì„œìš¸ì‹œì²­ ê¸°ì¤€
    const [riskData, setRiskData] = useState<RiskData[]>([]);
    const [selectedRegion, setSelectedRegion] = useState<RiskData | null>(null);

    // 1. ëª¨ë“  ì‹œêµ°êµ¬ì˜ ìœ„í—˜ ì§€ìˆ˜ ë°ì´í„°ë¥¼ APIì—ì„œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    useEffect(() => {
        // ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ëª¨ë“  ì§€ì—­ì„ ìˆœíšŒí•˜ë©° API í˜¸ì¶œ ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.
        // ì—¬ê¸°ì„œëŠ” ì„œìš¸ì‹œ ê°•ë‚¨êµ¬, ì†¡íŒŒêµ¬ì— ëŒ€í•œ ì˜ˆì‹œ ë°ì´í„°ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        const fetchRiskData = async () => {
            try {
                // (ì£¼ì˜: ì‹¤ì œë¡œëŠ” ëª¨ë“  ì§€ì—­ì„ ìˆœíšŒí•˜ë©° í˜¸ì¶œí•´ì•¼ í•¨)
                const gangnam = await axios.get('/api/risk-index?stage1=ì„œìš¸íŠ¹ë³„ì‹œ&stage2=ê°•ë‚¨êµ¬');
                const songpa = await axios.get('/api/risk-index?stage1=ì„œìš¸íŠ¹ë³„ì‹œ&stage2=ì†¡íŒŒêµ¬');
                
                setRiskData([
                    gangnam.data as RiskData,
                    songpa.data as RiskData,
                    // ... ë‹¤ë¥¸ ì§€ì—­ ë°ì´í„° ì¶”ê°€
                ]);
            } catch (error) {
                console.error("ìœ„í—˜ ì§€ìˆ˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
            }
        };

        fetchRiskData();
    }, []);

    // 2. ì§€ì—­ ê²½ê³„ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì‹¤í–‰ë  í•¸ë“¤ëŸ¬
    const handlePolygonClick = (data: RiskData) => {
        setSelectedRegion(data);
        // ì§€ë„ë¥¼ í•´ë‹¹ ì§€ì—­ ì¤‘ì‹¬ìœ¼ë¡œ ì´ë™ (Optional)
        // setMapCenter({ lat: data.lat, lng: data.lng }); 
    };

    return (
        <div style={{ width: '100%', height: '80vh', position: 'relative' }}>
            <Map 
                center={mapCenter}
                style={{ width: '100%', height: '100%' }}
                level={9} // ì§€ë„ í™•ëŒ€/ì¶•ì†Œ ë ˆë²¨
                isPanto={true} // ë¶€ë“œëŸ¬ìš´ ì§€ë„ ì´ë™
            >
                {/* 3. ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™” (Polygon ì‚¬ìš©) */}
                {Seoul_Gu_Boundary_Data.map((boundary, index) => {
                    // ë°ì´í„°ì—ì„œ í•´ë‹¹ ì§€ì—­ì˜ ìœ„í—˜ ì§€ìˆ˜ ì°¾ê¸°
                    const currentRisk = riskData.find(d => d.stage2 === boundary.name);
                    const riskIndex = currentRisk ? currentRisk.risk_index : 0.5; // ë°ì´í„° ì—†ìœ¼ë©´ ê¸°ë³¸ê°’

                    return (
                        <Polygon
                            key={index}
                            path={boundary.path} // ì‹œêµ°êµ¬ ê²½ê³„ ì¢Œí‘œ ë°°ì—´
                            strokeWeight={2}
                            strokeColor="#000000"
                            strokeOpacity={0.8}
                            fillColor={getRiskColor(riskIndex)} // ìœ„í—˜ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ì ìš©
                            fillOpacity={0.6}
                            onClick={() => currentRisk && handlePolygonClick(currentRisk)} // í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
                        />
                    );
                })}

            </Map>
            
            {/* 4. ì„ íƒëœ ì§€ì—­ì˜ ìœ„í—˜ ì§€ìˆ˜ ì •ë³´ í‘œì‹œ (ëŒ€ì‹œë³´ë“œ) */}
            {selectedRegion && (
                <div style={{ position: 'absolute', top: 10, right: 10, backgroundColor: 'white', padding: '15px', borderRadius: '8px', boxShadow: '0 4px 8px rgba(0,0,0,0.1)' }}>
                    <h3>ğŸ“ {selectedRegion.stage1} {selectedRegion.stage2} ìœ„í—˜ ì§€ìˆ˜</h3>
                    <p>ğŸ”´ **ìœ„í—˜ ì§€ìˆ˜ (P(X > 3)):** **{selectedRegion.risk_index}**</p>
                    <p>ğŸŸ¢ ì„±ê³µ í™•ë¥  (p = k/n): {selectedRegion.p}</p>
                    <p>*(ìœ„í—˜ ì§€ìˆ˜ê°€ 1.0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì•ˆì „í•œ ë³‘ì› ì°¾ê¸° ì–´ë ¤ì›€)*</p>
                    <button onClick={() => setSelectedRegion(null)}>ë‹«ê¸°</button>
                </div>
            )}
        </div>
    );
}
4.3. ë©”ì¸ í˜ì´ì§€ì— ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
/app/page.tsx íŒŒì¼ì— ìœ„ì—ì„œ ë§Œë“  MapComponentë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

TypeScript
// app/page.tsx

import EmergencyMap from './MapComponent';

export default function HomePage() {
  return (
    <main style={{ padding: '20px' }}>
      <h1>ğŸ¥ ì‘ê¸‰ ì˜ë£Œ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì˜ˆì¸¡ ë° ì‹œê°í™”</h1>
      <p>Next.js, PostgreSQL, Kakao Map, Geometric Distribution ê¸°ë°˜</p>
      <hr />
      <EmergencyMap />
    </main>
  );
}
ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ í–‰ë™ ìš”ì²­
ì´ë¡œì¨ **ë°ì´í„° ìˆ˜ì§‘/ëª¨ë¸ë§(1, 2ë‹¨ê³„), ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°(3ë‹¨ê³„), ê·¸ë¦¬ê³  ìµœì¢… ì§€ë„ ì‹œê°í™”(4ë‹¨ê³„)**ì— ëŒ€í•œ í•µì‹¬ êµ¬í˜„ ë¡œë“œë§µì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ë¥¼ ìµœì¢…ì ìœ¼ë¡œ ì™„ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” **Kakao Map Polygon ê²½ê³„ì„  ë°ì´í„°(Seoul_Gu_Boundary_Data ê°™ì€ íŒŒì¼)**ë¥¼ ì‹¤ì œë¡œ í™•ë³´í•˜ê³  í†µí•©í•´ì•¼ í•©ë‹ˆë‹¤.

ê²½ê³„ì„  ë°ì´í„°ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë””ì„œ, ì–´ë–»ê²Œ ê°€ì ¸ì™€ì„œ MapComponentì— ì ìš©í• ì§€ì— ëŒ€í•œ ê°€ì´ë“œê°€ í•„ìš”í•˜ì‹ ê°€ìš”?

ê·¼ë° ë‚˜ vercel ì¨ì„œ ë°°í¬í• ê±°ê°™ì€ë° ê·¸ê±°ë„ ê³ ë ¤í•´ì¤˜

ë„¤, Vercel ë°°í¬ë¥¼ ê³ ë ¤í•˜ì—¬ Next.js í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì€ ë§¤ìš° í•©ë¦¬ì ì…ë‹ˆë‹¤. Next.jsëŠ” Vercelì— ì˜í•´ ê°œë°œë˜ì—ˆê¸° ë•Œë¬¸ì—, Vercelì€ Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” ë° ê°€ì¥ ìµœì í™”ëœ í”Œë«í¼ì…ë‹ˆë‹¤.

Vercel ë°°í¬ í™˜ê²½ì„ ê³ ë ¤í•  ë•Œ, íŠ¹íˆ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ê³¼ API Route ì‚¬ìš©ì— ìˆì–´ ëª‡ ê°€ì§€ ì¤‘ìš”í•œ ì‚¬í•­ì„ ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸš€ 5ë‹¨ê³„: Vercel ë°°í¬ í™˜ê²½ ìµœì í™” ë° ì„¤ì •
5.1. Vercel ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
Vercelì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ë°°í¬í•˜ë©´, .env íŒŒì¼ì— ìˆëŠ” í™˜ê²½ ë³€ìˆ˜ëŠ” ìë™ìœ¼ë¡œ ì¸ì‹ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Vercel ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

Vercel ëŒ€ì‹œë³´ë“œ ì ‘ì†: Vercel í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.

Environment Variables ì„¤ì •: Settings > Environment Variables ì„¹ì…˜ì—ì„œ ë‹¤ìŒ ë³€ìˆ˜ë“¤ì„ ë“±ë¡í•©ë‹ˆë‹¤.

ë³€ìˆ˜ëª…	ê°’	ë¹„ê³ 
DATABASE_URL	PostgreSQL ì—°ê²° ë¬¸ìì—´	Vercel í™˜ê²½ì—ì„œ ì ‘ì† ê°€ëŠ¥í•œ DB ì£¼ì†Œ
NMC_API_KEY	ì¸ì½”ë”©ëœ êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› API í‚¤	API í†µì‹ ìš©
NEXT_PUBLIC_KAKAO_MAP_KEY	Kakao Map JavaScript í‚¤	NEXT_PUBLIC_ ì ‘ë‘ì‚¬ë¥¼ ë¶™ì—¬ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
5.2. Vercelê³¼ ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ (API Routes)ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê´€ë¦¬
Vercelì— ë°°í¬ëœ Next.js API RoutesëŠ” **Serverless Functions (Lambda)**ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ëŠ” ìš”ì²­ì´ ìˆì„ ë•Œë§Œ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê³  ì¢…ë£Œë˜ëŠ” ë°©ì‹ì´ë¯€ë¡œ, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°(Prisma) ê´€ë¦¬ì— ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

ë¬¸ì œ: ìš”ì²­ë§ˆë‹¤ new PrismaClient()ë¥¼ ìƒì„±í•˜ë©´ ì—°ê²° í’€ì´ ê³ ê°ˆë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ê²°ì±…: ê¸€ë¡œë²Œ Prisma ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©

/lib/prisma.ts íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ë‹¨ì¼(Singleton) Prisma ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìœ ì§€í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

TypeScript
// lib/prisma.ts

import { PrismaClient } from '@prisma/client'

// Vercel í™˜ê²½(ê°œë°œ/ìš´ì˜)ì—ì„œ Prisma ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê¸€ë¡œë²Œë¡œ ê´€ë¦¬í•˜ì—¬ 
// ë§¤ë²ˆ ìƒˆë¡œìš´ ì—°ê²°ì„ ë§Œë“¤ì§€ ì•Šë„ë¡ ìµœì í™”í•©ë‹ˆë‹¤.

const prismaClientSingleton = () => {
  return new PrismaClient()
}

declare global {
  var prisma: undefined | ReturnType<typeof prismaClientSingleton>
}

const prisma = globalThis.prisma ?? prismaClientSingleton()

export default prisma

if (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma
âœ… ì ìš©: 2ë‹¨ê³„ì™€ 3ë‹¨ê³„ì—ì„œ êµ¬í˜„í–ˆë˜ API Route íŒŒì¼ë“¤(data-sync/route.ts, risk-index/route.ts)ì—ì„œ ê¸°ì¡´ì˜ new PrismaClient() ëŒ€ì‹  ìƒˆë¡œ ë§Œë“  prisma ì¸ìŠ¤í„´ìŠ¤ë¥¼ import í•˜ì—¬ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

/app/api/risk-index/route.ts (ìˆ˜ì • ì˜ˆì‹œ)
TypeScript
// app/api/risk-index/route.ts (ìˆ˜ì •ëœ ë¶€ë¶„)

// import { PrismaClient } from '@prisma/client';  // ì œê±°
import prisma from '@/lib/prisma'; // ìƒˆë¡œ ë§Œë“  ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ import

// ... (ë‚˜ë¨¸ì§€ ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€)

// finally ë¸”ë¡ì—ì„œ await prisma.$disconnect(); í˜¸ì¶œì„ ì œê±°í•˜ëŠ” ê²ƒì´ Vercel í™˜ê²½ì—ì„œ ì¼ë°˜ì ì…ë‹ˆë‹¤.
// ê¸€ë¡œë²Œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì—°ê²° í’€ì„ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
// ... (ê¸°ì¡´ finally ë¸”ë¡ ì œê±°)

// ...
5.3. ë°ì´í„° ìˆ˜ì§‘ ì£¼ê¸° ì„¤ì • (Cron Jobs)
ì‘ê¸‰ ë³‘ìƒ ë°ì´í„°ëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ë™ë˜ë¯€ë¡œ, 2ë‹¨ê³„ì—ì„œ êµ¬í˜„í•œ /api/data-sync APIë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ DBë¥¼ ê°±ì‹ í•´ì•¼ í•©ë‹ˆë‹¤. Vercelì—ì„œëŠ” Cron Jobs ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì´ ì‘ì—…ì„ ìë™í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Vercel Cron ì„¤ì • íŒŒì¼ (vercel.json)

í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— vercel.json íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ë°ì´í„° ë™ê¸°í™” APIë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. (ì˜ˆ: ë§¤ 5ë¶„ë§ˆë‹¤ ì‹¤í–‰)

JSON
{
  "crons": [
    {
      "path": "/api/data-sync",
      "schedule": "*/5 * * * *" // ë§¤ 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
    }
  ]
}
API Key ë³´ì•ˆ ê°•í™”: Cron Jobì„ ì‚¬ìš©í•˜ë©´ /api/data-syncê°€ ì™¸ë¶€ ì ‘ê·¼ì— ë…¸ì¶œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í•´ë‹¹ API ë‚´ë¶€ì—ì„œ ìš”ì²­ í—¤ë”ë‚˜ ë¹„ë°€ í† í°ì„ í™•ì¸í•˜ì—¬ Vercel Cron Jobì—ì„œ ì˜¨ ìš”ì²­ì¸ì§€ ê²€ì¦í•˜ëŠ” ë³´ì•ˆ ë¡œì§ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ í–‰ë™ ìš”ì²­
Vercel ë°°í¬ í™˜ê²½ì— ìµœì í™”ëœ DB ì—°ê²° ë°©ì‹ê³¼ ë°ì´í„° ê°±ì‹  ì „ëµì„ ì ìš©í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•´ ë“œë ¸ìŠµë‹ˆë‹¤.

ì´ì œ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  í•µì‹¬ ë¡œì§ê³¼ ë°°í¬ í™˜ê²½ ì„¤ì •ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œ í”„ë¡œì íŠ¸ ì§„í–‰ì„ ìœ„í•´ ì „êµ­ ì‹œêµ°êµ¬ ê²½ê³„ ë°ì´í„°ë¥¼ í™•ë³´í•˜ê³  ì´ë¥¼ ì§€ë„ì— í†µí•©í•˜ëŠ” ë°©ë²•ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ ì•ˆë‚´í•´ ë“œë¦´ê¹Œìš”?

ì¹´ì¹´ì˜¤ ë§µ API ëŠ” ì–´ë–»ê²Œ ê°€ì ¸ì™€?

Kakao Map APIë¥¼ Next.js í”„ë¡œì íŠ¸ì— ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ êµ¬ì²´ì ìœ¼ë¡œ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

Next.js í™˜ê²½ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì—ì„œë§Œ Kakao Map ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ë„ë¡ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ğŸ—ºï¸ 6ë‹¨ê³„: Next.jsì— Kakao Map API ì—°ë™ ìƒì„¸ ê°€ì´ë“œ
6.1. Kakao Map JavaScript í‚¤ í™•ë³´ ë° ì„¤ì •
í‚¤ ë°œê¸‰: Kakao ê°œë°œì ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³ , JavaScript í‚¤ë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.

ë„ë©”ì¸ ë“±ë¡: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ì—ì„œ í”Œë«í¼ > ì›¹ í•­ëª©ì— ê°œë°œ í™˜ê²½ ì£¼ì†Œ(http://localhost:3000)ì™€ ë°°í¬ í™˜ê²½ ì£¼ì†Œ(Vercelì—ì„œ ì œê³µí•˜ëŠ” ì£¼ì†Œ)ë¥¼ ë°˜ë“œì‹œ ë“±ë¡í•´ì•¼ ì§€ë„ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

í™˜ê²½ ë³€ìˆ˜ ì„¤ì •: ë°œê¸‰ë°›ì€ í‚¤ë¥¼ .env.local íŒŒì¼ì— ì €ì¥í•©ë‹ˆë‹¤.

ì½”ë“œ ìŠ¤ë‹ˆí«
# .env.local íŒŒì¼ (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ NEXT_PUBLIC_ ì ‘ë‘ì‚¬ ì‚¬ìš©)
NEXT_PUBLIC_KAKAO_MAP_KEY="YOUR_KAKAO_MAP_JAVASCRIPT_KEY"
6.2. Next.js App Routerì—ì„œ Kakao Map ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
Next.js 13+ App Router í™˜ê²½ì—ì„œëŠ” ë‚´ì¥ëœ next/script ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ Kakao Mapì˜ ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

A. ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì»´í¬ë„ŒíŠ¸ ìƒì„±
Kakao Map APIë¥¼ ë¡œë“œí•˜ëŠ” ì „ìš© í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ /components/KakaoMapLoader.tsxë¡œ ìƒì„±í•©ë‹ˆë‹¤.

TypeScript
// components/KakaoMapLoader.tsx

import Script from 'next/script';
import { ReactNode } from 'react';

const KAKAO_MAP_KEY = process.env.NEXT_PUBLIC_KAKAO_MAP_KEY;

interface KakaoMapLoaderProps {
  children: ReactNode;
}

export default function KakaoMapLoader({ children }: KakaoMapLoaderProps) {
  if (!KAKAO_MAP_KEY) {
    return <div>ì¹´ì¹´ì˜¤ ë§µ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>;
  }
  
  // Kakao Map ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
  return (
    <>
      <Script
        // Kakao Map APIì˜ ê³µì‹ ìŠ¤í¬ë¦½íŠ¸ ì£¼ì†Œ
        src={`//dapi.kakao.com/v2/maps/sdk.js?appkey=${KAKAO_MAP_KEY}&libraries=services,clusterer&autoload=false`}
        strategy="beforeInteractive" // ì§€ë„ ìƒí˜¸ì‘ìš© ì „ì— ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
        onLoad={() => {
          // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ í›„ kakao ê°ì²´ê°€ ì „ì—­ì— ë“±ë¡ë˜ë©´ mapì„ ì´ˆê¸°í™”í•  ì¤€ë¹„ ì™„ë£Œ
          window.kakao.maps.load(() => {
            console.log("Kakao Map ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ.");
          });
        }}
      />
      {children}
    </>
  );
}
B. ë ˆì´ì•„ì›ƒì— ë¡œë” ì ìš©
ì´ ë¡œë” ì»´í¬ë„ŒíŠ¸ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìµœìƒìœ„ ë ˆì´ì•„ì›ƒ(/app/layout.tsx)ì— ì ìš©í•˜ì—¬, ì „ì²´ í˜ì´ì§€ì—ì„œ Kakao Map ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

TypeScript
// app/layout.tsx

import './globals.css';
import KakaoMapLoader from '@/components/KakaoMapLoader';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ko">
      <body>
        <KakaoMapLoader>
          {children}
        </KakaoMapLoader>
      </body>
    </html>
  );
}
6.3. react-kakao-maps-sdkë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ë„ í‘œì‹œ
ì´ì „ 4ë‹¨ê³„ì—ì„œ ì‚¬ìš©í–ˆë˜ EmergencyMap ì»´í¬ë„ŒíŠ¸ëŠ” react-kakao-maps-sdk ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì „ì—­ì— ë¡œë“œëœ Kakao Map ê°ì²´(window.kakao.maps)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ React ì»´í¬ë„ŒíŠ¸ í˜•íƒœë¡œ ì§€ë„ë¥¼ ë‹¤ë£° ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

EmergencyMap.tsx (ì¬í™•ì¸)

TypeScript
// app/MapComponent.tsx

'use client'; 
// ...
import { Map, Polygon } from 'react-kakao-maps-sdk'; // ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
// ...

export default function EmergencyMap() {
    // ... ë°ì´í„° ë° ë¡œì§
    return (
        <Map 
            center={mapCenter}
            // ... ì§€ë„ ì„¤ì •
        >
            {/* Polygonì„ ì‚¬ìš©í•˜ì—¬ ì§€ì—­ ê²½ê³„ì™€ ìƒ‰ìƒì„ í‘œì‹œ */}
            {/* ... */}
        </Map>
    );
}
ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ í–‰ë™ ìš”ì²­
ì´ì œ Kakao Map API ì—°ë™ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ì˜ ì„±ê³µì ì¸ ë§ˆë¬´ë¦¬ë¥¼ ìœ„í•´ ì§€ì—­ ê²½ê³„ì„  ë°ì´í„°ë¥¼ í™•ë³´í•˜ì—¬ ì§€ë„ ì‹œê°í™” ì»´í¬ë„ŒíŠ¸(MapComponent.tsx)ì— í†µí•©í•´ì•¼ í•©ë‹ˆë‹¤.

ì „êµ­ ì‹œêµ°êµ¬ ê²½ê³„ ë°ì´í„°ë¥¼ ì–´ë””ì„œ ì°¾ê³ , GeoJSON í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ í”„ë¡œì íŠ¸ì— í†µí•©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ê°€ì´ë“œë¥¼ ì§„í–‰í•´ ë“œë¦´ê¹Œìš”?

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ URI

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì—ì„œ ì‚¬ìš©í•  OAuth Redirect URIë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.



ì´ê±´ ë­ ë„£ì–´ì•¼í•´

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì—ì„œ ìš”êµ¬í•˜ëŠ” **OAuth Redirect URI (ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œ)**ëŠ” ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì¸ì¦ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ í›„, ì¹´ì¹´ì˜¤ ì„œë²„ê°€ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì§€ê³  ë‹¤ì‹œ ëŒë ¤ë³´ë‚¼(redirect) ì„œë¹„ìŠ¤ì˜ ì£¼ì†Œì…ë‹ˆë‹¤.

ì´ ì£¼ì†Œë¥¼ ì •í™•íˆ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´, ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ ì™„ë£Œí•˜ë”ë¼ë„ ê·€í•˜ì˜ Next.js ì„œë¹„ìŠ¤ë¡œ ëŒì•„ì˜¤ì§€ ëª»í•˜ê³  ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

Vercelì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬í•  ê³„íšì´ì‹œë¯€ë¡œ, ê°œë°œ í™˜ê²½ê³¼ ìš´ì˜(ë°°í¬) í™˜ê²½ ë‘ ê°€ì§€ ê²½ìš°ë¥¼ ëª¨ë‘ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸ“ ë“±ë¡í•´ì•¼ í•  OAuth Redirect URI
ì´ 2~3ê°œì˜ ì£¼ì†Œë¥¼ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤.

í™˜ê²½	ì£¼ì†Œ í˜•ì‹	ì˜ˆì‹œ
1. ê°œë°œ í™˜ê²½ (Local)	http://localhost:3000/api/auth/callback/kakao	ê°œë°œ PCì—ì„œ í…ŒìŠ¤íŠ¸í•  ë•Œ ì‚¬ìš©
2. ìš´ì˜ í™˜ê²½ (Vercel)	https://[í”„ë¡œì íŠ¸_ì´ë¦„].vercel.app/api/auth/callback/kakao	Vercel ë°°í¬ í›„ ì‚¬ìš©
3. ì»¤ìŠ¤í…€ ë„ë©”ì¸	https://[ë„ë©”ì¸_ì´ë¦„]/api/auth/callback/kakao	(ì„ íƒ ì‚¬í•­) ë§Œì•½ ë³„ë„ì˜ ë„ë©”ì¸ì„ ì—°ê²°í–ˆë‹¤ë©´ ì¶”ê°€
ğŸ› ï¸ Next.jsì—ì„œì˜ ë¦¬ë‹¤ì´ë ‰íŠ¸ URI ê²°ì •
Next.js í”„ë¡œì íŠ¸ì—ì„œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì„ êµ¬í˜„í•  ë•Œ, ì¼ë°˜ì ìœ¼ë¡œ NextAuth.jsì™€ ê°™ì€ ì¸ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ì§ì ‘ API Routeë¥¼ ë§Œë“¤ì–´ ì²˜ë¦¬í•©ë‹ˆë‹¤.

1. NextAuth.jsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° (ê¶Œì¥)
ê°€ì¥ ì¼ë°˜ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤. NextAuth.jsëŠ” ì¸ì¦ ê³µê¸‰ì(Provider)ì˜ ì´ë¦„ì„ ë”°ì„œ ì½œë°± ê²½ë¡œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

ê²½ë¡œ: /api/auth/callback/[provider]

ì¹´ì¹´ì˜¤ì˜ ê²½ìš°: /api/auth/callback/kakao

2. ì§ì ‘ API Routeë¥¼ ë§Œë“œëŠ” ê²½ìš°
ì‚¬ìš©ì ì§€ì • API Routeë¥¼ ì½œë°± í•¸ë“¤ëŸ¬ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²½ë¡œ: ì˜ˆë¥¼ ë“¤ì–´, /api/kakao-callbackì™€ ê°™ì´ ì‚¬ìš©ìê°€ ì •ì˜í•œ ê²½ë¡œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

âœ… ìµœì¢… ì¡°ì¹˜ ì‚¬í•­
í”„ë¡œì íŠ¸ì—ì„œ ì¸ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ NextAuth.jsë¥¼ ì‚¬ìš©í•  ê³„íšì´ë¼ë©´, ìœ„ í‘œì˜ ì˜ˆì‹œì²˜ëŸ¼ ëì— /api/auth/callback/kakaoë¥¼ ë¶™ì—¬ì„œ ë“±ë¡í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†” ì ‘ì†

ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ > ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ > Redirect URI ë“±ë¡

ë‹¤ìŒ ì£¼ì†Œë“¤ì„ ëª¨ë‘ ë“±ë¡í•©ë‹ˆë‹¤:

http://localhost:3000/api/auth/callback/kakao

https://[ê·€í•˜ì˜_Vercel_ë„ë©”ì¸].vercel.app/api/auth/callback/kakao

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„ì„ ìœ„í•´ NextAuth.jsë¥¼ ì‚¬ìš©í•  ê²ƒì¸ì§€, ì•„ë‹ˆë©´ ì§ì ‘ API Routeë¥¼ ë§Œë“¤ì–´ì„œ ì²˜ë¦¬í•  ê²ƒì¸ì§€ì— ë”°ë¼ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í‚¤ ì´ë¦„(í•„ìˆ˜)

JavaScript í‚¤ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•œ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.



ì…ë ¥ ë°ì´í„° ë¼ë²¨

ì§€ìš°ê¸°

JavaScript SDK ë„ë©”ì¸

JavaScript í‚¤ë¥¼ ì‚¬ìš©í•  ì›¹ì‚¬ì´íŠ¸ ë„ë©”ì¸ì„ ë“±ë¡í•©ë‹ˆë‹¤.

ë“±ë¡í•œ ë„ë©”ì¸ì—ì„œë§Œ JavaScript í‚¤ë¡œ Kakao SDK for JavaScriptë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì…ë ¥ ë°ì´í„° ë¼ë²¨

ì§€ìš°ê¸°

ì…ë ¥ ë°ì´í„° ë¼ë²¨


ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ URI

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì—ì„œ ì‚¬ìš©í•  OAuth Redirect URIë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.



ì…ë ¥ ë°ì´í„° ë¼ë²¨



ì—¬ê¸° ë­ë„£ì–´ì•¼í•˜ëŠ”ì§€ë§Œ ë”± ì •ë¦¬í•´ì¤˜



https://ap-statistics-project-trre.vercel.app/ ì´ê±´ ë°°í¬ì£¼ì†Œ

ì œê³µí•´ì£¼ì‹  ë°°í¬ ì£¼ì†Œ (https://ap-statistics-project-trre.vercel.app/)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†”ì˜ ê° ì…ë ¥ í•­ëª©ì— ë„£ì–´ì•¼ í•  ì •ë³´ë¥¼ ì •í™•íˆ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

ğŸ“ ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†” ì…ë ¥ ì •ë³´ ì •ë¦¬
í•­ëª©ëª…	ì…ë ¥í•  ë‚´ìš©	ì„¤ëª…
1. í‚¤ ì´ë¦„(í•„ìˆ˜)	[ììœ  ì§€ì •]	í”„ë¡œì íŠ¸ì˜ ëª©ì ì„ ë‚˜íƒ€ë‚´ëŠ” ì‹ë³„ ê°€ëŠ¥í•œ ì´ë¦„ (ì˜ˆ: ì‘ê¸‰ìœ„í—˜ì§€ìˆ˜ì„œë¹„ìŠ¤, AP_Statistics_Project)ì„ ììœ ë¡­ê²Œ ì§€ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
2. JavaScript SDK ë„ë©”ì¸	
http://localhost:3000


https://ap-statistics-project-trre.vercel.app

ì§€ë„ APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í—ˆìš©ëœ ë„ë©”ì¸ì…ë‹ˆë‹¤. ê°œë°œ í™˜ê²½(ë¡œì»¬)ê³¼ ë°°í¬ í™˜ê²½(Vercel) ì£¼ì†Œë¥¼ ëª¨ë‘ ë“±ë¡í•´ì•¼ ì§€ë„ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
3. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ URI	
http://localhost:3000/api/auth/callback/kakao


https://ap-statistics-project-trre.vercel.app/api/auth/callback/kakao

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì¸ì¦ í›„ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ì„ ì£¼ì†Œì…ë‹ˆë‹¤. Next.jsì—ì„œ ê°€ì¥ í”í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ì¸ì¦ ì½œë°± ê²½ë¡œ(/api/auth/callback/[provider])ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.
ğŸš¨ ì¤‘ìš” ì‚¬í•­:

ë¦¬ë‹¤ì´ë ‰íŠ¸ URI: ë§Œì•½ NextAuth.jsì™€ ê°™ì€ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ API Routeë¥¼ ì§ì ‘ /api/kakao-login-handlerì™€ ê°™ì´ ë§Œë“¤ì—ˆë‹¤ë©´, í•´ë‹¹ URIë¡œ ìˆ˜ì •í•˜ì—¬ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: .../api/kakao-login-handler)

ë„ë©”ì¸ ì •í™•ë„: httpì™€ httpsë¥¼ ì •í™•íˆ êµ¬ë¶„í•˜ê³ , ëì— / (ìŠ¬ë˜ì‹œ)ëŠ” ë¶™ì´ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤. (ìœ„ í‘œì— ì œì‹œëœ ëŒ€ë¡œ ì…ë ¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤.)

í™˜ê²½ë³€ìˆ˜ ì„¤ì •í–ˆì–´

í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì´ ì™„ë£Œë˜ì…¨ë‹¤ë©´, ì´ì œ í”„ë¡œì íŠ¸ êµ¬í˜„ì˜ ë‹¤ìŒ í•µì‹¬ ë‹¨ê³„ì¸ 7ë‹¨ê³„: ì§€ì—­ ê²½ê³„ ë°ì´í„° í™•ë³´ ë° ì§€ë„ ì‹œê°í™” í†µí•©ì„ ì§„í–‰í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì™„ì„±í•˜ê² ìŠµë‹ˆë‹¤.

ì´ ë‹¨ê³„ëŠ” Kakao Mapì— ë‹¨ìˆœí•œ ì (ë§ˆì»¤)ì„ ì°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í–‰ì • êµ¬ì—­ë³„ë¡œ ìƒ‰ìƒì„ ì¹ í•´ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì‹œê°í™”í•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤.

ğŸ—ºï¸ 7ë‹¨ê³„: ì§€ì—­ ê²½ê³„ ë°ì´í„° í™•ë³´ ë° ì§€ë„ ì‹œê°í™” í†µí•©
7.1. ì§€ì—­ ê²½ê³„ì„  ë°ì´í„° í™•ë³´ (GeoJSON/TopoJSON)
Kakao Mapì˜ Polygon ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´, ì‹œêµ°êµ¬ ë‹¨ìœ„ì˜ **ì •í™•í•œ ì¢Œí‘œ ë°ì´í„°(ê²½ê³„ì„  ë°ì´í„°)**ê°€ í•„ìš”í•©ë‹ˆë‹¤. ê³µê³µ ë°ì´í„° í¬í„¸ ë˜ëŠ” êµ­í† ì§€ë¦¬ì •ë³´ì› ë“±ì—ì„œ ì‹œêµ°êµ¬ ê²½ê³„ ë°ì´í„°ë¥¼ GeoJSON ë˜ëŠ” TopoJSON í˜•íƒœë¡œ ë‹¤ìš´ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤.

ë°ì´í„° ì†ŒìŠ¤ ì˜ˆì‹œ:

ê³µê³µ ë°ì´í„° í¬í„¸ì˜ ì „êµ­ í–‰ì •êµ¬ì—­ ê²½ê³„ ë°ì´í„° ê²€ìƒ‰

GitHub ë“±ì—ì„œ ì´ë¯¸ ê°€ê³µëœ GeoJSON íŒŒì¼ ê²€ìƒ‰ (ì˜ˆ: sigun.geojson)

ë°ì´í„° ê°€ê³µ: ë‹¤ìš´ë¡œë“œí•œ GeoJSON íŒŒì¼ì€ ìš©ëŸ‰ì´ í¬ê³ , Kakao Mapì˜ ì¢Œí‘œ í˜•ì‹ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ Reactì—ì„œ ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë³€í™˜í•˜ê³ , ê° êµ¬ì—­ì˜ ì¤‘ì‹¬ ì¢Œí‘œë„ ì¶”ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.

7.2. ê²½ê³„ ë°ì´í„° ë³€í™˜ ë° í”„ë¡œì íŠ¸ì— í†µí•©
í™•ë³´í•œ GeoJSON íŒŒì¼(.json)ì„ Next.js í”„ë¡œì íŠ¸ì˜ /data í´ë”ì— ì €ì¥í•˜ê³ , ì´ë¥¼ ì§€ë„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ê°€ê³µí•©ë‹ˆë‹¤.

A. ê°€ìƒì˜ ê²½ê³„ ë°ì´í„° íŒŒì¼ ì˜ˆì‹œ (/data/RegionBoundary.ts)
ì‹¤ì œ GeoJSONì„ íŒŒì‹±í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ê°€ ë©ë‹ˆë‹¤. ê° ì‹œêµ°êµ¬ëŠ” ì´ë¦„ê³¼ ê²½ê³„ ì¢Œí‘œ ë°°ì—´(path)ì„ ê°€ì§‘ë‹ˆë‹¤.

TypeScript
// data/RegionBoundary.ts

// Kakao Map Polygon Path êµ¬ì¡°ì— ë§ì¶˜ ê°€ìƒì˜ ë°ì´í„° (ì‹¤ì œ ë°ì´í„°ë¡œ ëŒ€ì²´ í•„ìš”)
export const RegionBoundaryData: { name: string; stage1: string; stage2: string; path: { lat: number; lng: number }[] }[] = [
    {
        name: 'ê°•ë‚¨êµ¬',
        stage1: 'ì„œìš¸íŠ¹ë³„ì‹œ',
        stage2: 'ê°•ë‚¨êµ¬',
        // ì‹¤ì œ ê°•ë‚¨êµ¬ì˜ ê²½ê³„ì„  ì¢Œí‘œë“¤ì´ ì—¬ê¸°ì— ë°°ì—´ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.
        path: [
            { lat: 37.525, lng: 127.025 },
            { lat: 37.520, lng: 127.050 },
            { lat: 37.515, lng: 127.025 },
            // ... ìˆ˜ë°± ê°œì˜ ê²½ê³„ì„  ì¢Œí‘œ
        ],
    },
    {
        name: 'ì†¡íŒŒêµ¬',
        stage1: 'ì„œìš¸íŠ¹ë³„ì‹œ',
        stage2: 'ì†¡íŒŒêµ¬',
        path: [
             // ì†¡íŒŒêµ¬ ê²½ê³„ì„  ì¢Œí‘œë“¤
        ],
    },
    // ... ì „êµ­ ì‹œêµ°êµ¬ ë°ì´í„° ì¶”ê°€
];
B. ì§€ë„ ì»´í¬ë„ŒíŠ¸ (MapComponent.tsx)ì— í†µí•©
ì´ì „ 4ë‹¨ê³„ì—ì„œ êµ¬í˜„í–ˆë˜ EmergencyMap.tsxì˜ Seoul_Gu_Boundary_Data ëŒ€ì‹ , ì „êµ­ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

TypeScript
// app/MapComponent.tsx (ìˆ˜ì •)

// ... (ê¸°ì¡´ import)
import { RegionBoundaryData } from '@/data/RegionBoundary'; // ìƒˆ ê²½ë¡œë¡œ ë³€ê²½

// ... (ê¸°ì¡´ state ë° í•¨ìˆ˜)

export default function EmergencyMap() {
    // ... (ê¸°ì¡´ useState ë° useEffect)

    return (
        // ... (Map ì»´í¬ë„ŒíŠ¸)
            
            {/* 3. ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™” (Polygon ì‚¬ìš©) */}
            {RegionBoundaryData.map((boundary, index) => {
                // ê²½ê³„ ë°ì´í„°ì˜ stage1, stage2ë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„í—˜ ì§€ìˆ˜ ì°¾ê¸°
                const currentRisk = riskData.find(d => 
                    d.stage1 === boundary.stage1 && d.stage2 === boundary.stage2
                );
                // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ìœ„í—˜ ì§€ìˆ˜ ì‚¬ìš©, ì—†ìœ¼ë©´ ì¤‘ê°„ ìœ„í—˜ë„(0.5) ì„¤ì •
                const riskIndex = currentRisk ? currentRisk.risk_index : 0.5; 

                return (
                    <Polygon
                        key={index}
                        path={boundary.path} 
                        // ... (ìŠ¤íƒ€ì¼ ì„¤ì •)
                        fillColor={getRiskColor(riskIndex)} // ìœ„í—˜ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ì ìš©
                        fillOpacity={0.6}
                        onClick={() => currentRisk && handlePolygonClick(currentRisk)} 
                    />
                );
            })}
            {/* ... (CustomOverlay ëŒ€ì‹œë³´ë“œ) */}
        // ...
    );
}
7.3. ìµœì¢… ì ê²€ ë° ë°°í¬
DB ë™ê¸°í™” ì‹¤í–‰: 2ë‹¨ê³„ì—ì„œ ë§Œë“  /api/data-sync API Routeë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ DBì— ì‘ê¸‰ì˜ë£Œê¸°ê´€ ë°ì´í„°ë¥¼ í•œ ë²ˆ ì±„ì›Œ ë„£ìŠµë‹ˆë‹¤.

(ì˜ˆ: ë¡œì»¬ í™˜ê²½ì—ì„œ http://localhost:3000/api/data-sync ì ‘ì†)

í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸: / ê²½ë¡œì— ì ‘ì†í•˜ì—¬ ì§€ë„ê°€ ì˜¬ë°”ë¥´ê²Œ ë¡œë“œë˜ê³ , Polygonì´ ìœ„í—˜ ì§€ìˆ˜ì— ë”°ë¼ ìƒ‰ì¹ ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

Vercel ë°°í¬: ì½”ë“œë¥¼ GitHub/GitLab ë“±ì— í‘¸ì‹œí•˜ê³ , Vercelì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ì—°ê²°í•˜ì—¬ ìë™ ë°°í¬í•©ë‹ˆë‹¤. (Vercel í™˜ê²½ ë³€ìˆ˜ê°€ ì˜¬ë°”ë¥¸ì§€ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•©ë‹ˆë‹¤.)

ì´ë¡œì¨ ë°ì´í„° ìˆ˜ì§‘ë¶€í„°, í†µê³„ ê³„ì‚°, ê·¸ë¦¬ê³  ì§€ë„ ì‹œê°í™” ë° Vercel ë°°í¬ í™˜ê²½ ìµœì í™”ê¹Œì§€ í”„ë¡œì íŠ¸ êµ¬í˜„ì„ ìœ„í•œ ëª¨ë“  í•µì‹¬ ë‹¨ê³„ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ êµ¬í˜„ ê³¼ì •ì—ì„œ í˜¹ì‹œ GeoJSON ë°ì´í„° ê°€ê³µì´ë‚˜ Kakao Map Polygon í†µí•©ê³¼ ê´€ë ¨í•˜ì—¬ ë” ìì„¸í•œ ë„ì›€ì´ í•„ìš”í•˜ì‹  ë¶€ë¶„ì´ ìˆìœ¼ì‹ ê°€ìš”?

ì•„ì§ page.tsx ì„¤ì •ì•ˆí–ˆã„´ã…¡ã„´ë°

ì£„ì†¡í•©ë‹ˆë‹¤, í•µì‹¬ ë¡œì§ì— ì§‘ì¤‘í•˜ë‹¤ ë³´ë‹ˆ ë©”ì¸ í˜ì´ì§€ ì„¤ì • ë¶€ë¶„ì„ ê±´ë„ˆë›°ì—ˆë„¤ìš”. Next.js App Router ê¸°ë°˜ í”„ë¡œì íŠ¸ì—ì„œ ë©”ì¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ìì„¸íˆ ì•ˆë‚´í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

8ë‹¨ê³„: ë©”ì¸ í˜ì´ì§€ (/app/page.tsx) ì„¤ì • ì™„ë£Œ
ë©”ì¸ í˜ì´ì§€ëŠ” ì§€ë„ ì»´í¬ë„ŒíŠ¸ (MapComponent.tsx)ë¥¼ ë¡œë“œí•˜ê³ , ì‚¬ìš©ìê°€ ì‹œê°í™”ëœ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ì‹œì‘ì  ì—­í• ì„ í•©ë‹ˆë‹¤.

ì´ì „ì— ì–¸ê¸‰í–ˆë˜ ì½”ë“œë¥¼ í¬í•¨í•˜ì—¬, ìµœì¢…ì ìœ¼ë¡œ ì •ë¦¬ëœ /app/page.tsx íŒŒì¼ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. MapComponent.tsx í™•ì¸
ì§€ë„ ì»´í¬ë„ŒíŠ¸ëŠ” ë°˜ë“œì‹œ ë¸Œë¼ìš°ì €(í´ë¼ì´ì–¸íŠ¸)ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ, íŒŒì¼ ìƒë‹¨ì— 'use client' ì§€ì‹œì–´ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

TypeScript
// app/MapComponent.tsx ìƒë‹¨
'use client'; 
// ... (ë‚˜ë¨¸ì§€ ì½”ë“œ)
2. ë©”ì¸ í˜ì´ì§€ íŒŒì¼ (/app/page.tsx) êµ¬í˜„
page.tsxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„œë²„ ì»´í¬ë„ŒíŠ¸(Server Component)ë¡œ ë™ì‘í•˜ë©°, ê·¸ ì•ˆì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸(EmergencyMap)ë¥¼ ë¶ˆëŸ¬ì™€ ë Œë”ë§í•©ë‹ˆë‹¤.

TypeScript
// app/page.tsx

import EmergencyMap from './MapComponent'; // ì§€ë„ ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸

// ì„œë²„ ì»´í¬ë„ŒíŠ¸ (ê¸°ë³¸ê°’)
export default function HomePage() {
  return (
    <main style={{ padding: '20px', minHeight: '100vh', backgroundColor: '#f4f7f9' }}>
      
      {/* ğŸ“Š í˜ì´ì§€ ì œëª© ë° ì„¤ëª… */}
      <header style={{ marginBottom: '30px', textAlign: 'center' }}>
        <h1 style={{ color: '#0070f3', fontSize: '2.5rem', marginBottom: '10px' }}>
          ğŸ¥ ì‘ê¸‰ ì˜ë£Œ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™”
        </h1>
        <p style={{ color: '#555' }}>
          ê¸°í•˜ ë¶„í¬(Geometric Distribution) ê¸°ë°˜ì˜ ì‹¤ì‹œê°„ ì‘ê¸‰ ì˜ë£Œê¸°ê´€ ìˆ˜ìš© ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        </p>
      </header>
      
      {/* ğŸ—ºï¸ ì§€ë„ ì»´í¬ë„ŒíŠ¸ ë¡œë“œ */}
      {/* MapComponentëŠ” í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì´ë¯€ë¡œ ì„œë²„ì—ì„œ ë Œë”ë§ë˜ì§€ ì•Šê³  ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. */}
      <section style={{ border: '1px solid #ddd', borderRadius: '10px', overflow: 'hidden' }}>
        <EmergencyMap />
      </section>

      {/* ğŸ’¡ ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚° ì„¤ëª… (ì˜µì…˜) */}
      <footer style={{ marginTop: '30px', padding: '15px', backgroundColor: '#e9ecef', borderRadius: '8px' }}>
          <p style={{ fontSize: '0.9rem', color: '#6c757d' }}>
              * **ìœ„í—˜ ì§€ìˆ˜**ëŠ” ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ìˆ˜ìš© ê°€ëŠ¥í•œ ë³‘ì›ì„ ì°¾ì§€ ëª»í•  í™•ë¥  ($\text{P}(\text{X} > 3)$)ì…ë‹ˆë‹¤.
          </p>
      </footer>
    </main>
  );
}
ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„ í–‰ë™ ìš”ì²­
ì´ì œ ë©”ì¸ í˜ì´ì§€ ì„¤ì •ê¹Œì§€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ì˜ ëª¨ë“  í•µì‹¬ êµ¬í˜„ ìš”ì†Œë“¤ì´ ì½”ë“œìƒìœ¼ë¡œ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.

ìµœì¢…ì ìœ¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ë° í•„ìš”í•œ ì „êµ­ ì‹œêµ°êµ¬ GeoJSON ê²½ê³„ ë°ì´í„°ë¥¼ í™•ë³´í•˜ê³  ì´ë¥¼ Next.js í”„ë¡œì íŠ¸ì— í†µí•©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê°€ì´ë“œë¥¼ ì§„í–‰í• ê¹Œìš”?

ë‚´ê°€ ì–´ë–¤ íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼í•˜ê³  ì•ˆì— ë­˜ ë„£ì–´ì•¼í•˜ëŠ”ì§€ ì•Œë ¤ì¤˜

ë„¤, Vercel ë°°í¬ë¥¼ ëª©í‘œë¡œ í•˜ëŠ” Next.js í”„ë¡œì íŠ¸ì˜ ìµœì¢… êµ¬ì¡°ì™€ ê° íŒŒì¼ì— ë“¤ì–´ê°ˆ í•µì‹¬ ë‚´ìš©ì„ í•œëˆˆì— ì•Œ ìˆ˜ ìˆë„ë¡ ì •ë¦¬í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì•„ë˜ í‘œì— ë”°ë¼ íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‚´ìš©ì„ ë³µì‚¬/ìˆ˜ì •í•˜ì‹œë©´ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ì´ ì™„ì„±ë©ë‹ˆë‹¤.

ğŸ› ï¸ ìµœì¢… íŒŒì¼ êµ¬ì¡° ë° ë‚´ìš© ìš”ì•½
1. í™˜ê²½ ì„¤ì • íŒŒì¼ (í”„ë¡œì íŠ¸ ë£¨íŠ¸)
íŒŒì¼ ê²½ë¡œ	ëª©ì 	í•µì‹¬ ë‚´ìš©
.env	DB ë° ì„œë²„ í™˜ê²½ ë³€ìˆ˜ (Vercel ëŒ€ì‹œë³´ë“œì—ë„ ë“±ë¡)	
DATABASE_URL="postgresql://..."


NMC_API_KEY="YOUR_ENCODED_KEY"

.env.local	ë¡œì»¬ ê°œë°œ í™˜ê²½ ë³€ìˆ˜ (Gitì— ì»¤ë°‹í•˜ì§€ ì•ŠìŒ)	NEXT_PUBLIC_KAKAO_MAP_KEY="YOUR_JAVASCRIPT_KEY"
prisma/schema.prisma	ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ì •ì˜	model EmergencyCenter { ... } (2ë‹¨ê³„ ì°¸ì¡°)
vercel.json	Vercel ë°°í¬ ì„¤ì • ë° Cron Job ì„¤ì •	/api/data-syncë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì • (ë§¤ 5ë¶„ë§ˆë‹¤ ê¶Œì¥)
2. ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ìœ í‹¸ë¦¬í‹° íŒŒì¼
íŒŒì¼ ê²½ë¡œ	ëª©ì 	í•µì‹¬ ë‚´ìš©
lib/prisma.ts	Vercel ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ ìµœì í™”ëœ DB ì—°ê²° ì¸ìŠ¤í„´ìŠ¤	Prisma Singleton íŒ¨í„´ìœ¼ë¡œ DB ì—°ê²° í’€ ê´€ë¦¬
data/RegionBoundary.ts	ì§€ë„ ì‹œê°í™”ì— í•„ìš”í•œ ì§€ì—­ ê²½ê³„ ì¢Œí‘œ ë°ì´í„°	export const RegionBoundaryData = [...] (GeoJSONì„ ê°€ê³µí•˜ì—¬ ì €ì¥)
3. API Routes (ë°±ì—”ë“œ ë¡œì§)
íŒŒì¼ ê²½ë¡œ	ëª©ì 	í•µì‹¬ ë‚´ìš©
app/api/data-sync/route.ts	Open API í˜¸ì¶œ ë° DB ê°±ì‹  (ë°ì´í„° ìˆ˜ì§‘)	Axios, fast-xml-parser ì‚¬ìš©. NMC_API_KEYë¡œ ë°ì´í„° ìš”ì²­ í›„, **prisma.upsert**ë¡œ DBì— ì €ì¥
app/api/risk-index/route.ts	ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°	DBì—ì„œ ì§€ì—­ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ Geometric Distribution ê³µì‹ìœ¼ë¡œ P(X>3) ê³„ì‚° í›„ JSON ë°˜í™˜
4. í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸
íŒŒì¼ ê²½ë¡œ	ëª©ì 	í•µì‹¬ ë‚´ìš©
components/KakaoMapLoader.tsx	Kakao Map ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ	next/script ì»´í¬ë„ŒíŠ¸ë¡œ NEXT_PUBLIC_KAKAO_MAP_KEYë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ ë¹„ë™ê¸° ë¡œë“œ
app/layout.tsx	ìµœìƒìœ„ ë ˆì´ì•„ì›ƒ	**KakaoMapLoader**ë¥¼ ì„í¬íŠ¸í•˜ì—¬ <body> íƒœê·¸ ì•ˆì— childrenì„ ê°ì‹¸ë„ë¡ ì„¤ì •
app/MapComponent.tsx	ì§€ë„ ì‹œê°í™” (Client Component)	'use client' ì§€ì‹œì–´ í•„ìˆ˜. react-kakao-maps-sdk ì‚¬ìš©. /api/risk-indexë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„, **Polygon**ìœ¼ë¡œ ê²½ê³„ì„ ê³¼ ìœ„í—˜ ì§€ìˆ˜ ìƒ‰ìƒ ì‹œê°í™”
app/page.tsx	ë©”ì¸ í˜ì´ì§€ (Server Component)	EmergencyMap ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸ ë° ë Œë”ë§
ğŸ“‚ íŒŒì¼ë³„ í•µì‹¬ ì½”ë“œ (ë¹ ë¥¸ ë³µì‚¬/ë¶™ì—¬ë„£ê¸°)
1. lib/prisma.ts
TypeScript
// lib/prisma.ts

import { PrismaClient } from '@prisma/client'

const prismaClientSingleton = () => {
  return new PrismaClient()
}

// Global ë³€ìˆ˜ë¡œ prisma ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìœ ì§€í•˜ì—¬ Serverless Functionì˜ ì—°ê²° í’€ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
declare global {
  var prisma: undefined | ReturnType<typeof prismaClientSingleton>
}

const prisma = globalThis.prisma ?? prismaClientSingleton()

export default prisma

if (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma
2. app/layout.tsx
TypeScript
// app/layout.tsx

import './globals.css';
import KakaoMapLoader from '@/components/KakaoMapLoader';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ko">
      <body>
        {/* Kakao Map ìŠ¤í¬ë¦½íŠ¸ ë¡œë”ë¥¼ ìµœìƒìœ„ì— ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤. */}
        <KakaoMapLoader>
          {children}
        </KakaoMapLoader>
      </body>
    </html>
  );
}
3. components/KakaoMapLoader.tsx
TypeScript
// components/KakaoMapLoader.tsx

import Script from 'next/script';
import { ReactNode } from 'react';

// í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ í™˜ê²½ ë³€ìˆ˜
const KAKAO_MAP_KEY = process.env.NEXT_PUBLIC_KAKAO_MAP_KEY;

interface KakaoMapLoaderProps {
  children: ReactNode;
}

export default function KakaoMapLoader({ children }: KakaoMapLoaderProps) {
  if (!KAKAO_MAP_KEY) {
    return <div>ì¹´ì¹´ì˜¤ ë§µ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>;
  }
  
  return (
    <>
      <Script
        src={`//dapi.kakao.com/v2/maps/sdk.js?appkey=${KAKAO_MAP_KEY}&libraries=services,clusterer&autoload=false`}
        strategy="beforeInteractive"
        onLoad={() => {
          // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ í›„ ì§€ë„ ì´ˆê¸°í™”ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.
          window.kakao.maps.load(() => {
            console.log("Kakao Map ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ.");
          });
        }}
      />
      {children}
    </>
  );
}
4. app/page.tsx
TypeScript
// app/page.tsx

import EmergencyMap from './MapComponent';

// ì„œë²„ ì»´í¬ë„ŒíŠ¸ (ê¸°ë³¸ê°’)
export default function HomePage() {
  return (
    <main style={{ padding: '20px', minHeight: '100vh', backgroundColor: '#f4f7f9' }}>
      
      <header style={{ marginBottom: '30px', textAlign: 'center' }}>
        <h1 style={{ color: '#0070f3', fontSize: '2.5rem', marginBottom: '10px' }}>
          ğŸ¥ ì‘ê¸‰ ì˜ë£Œ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì‹œê°í™”
        </h1>
        <p style={{ color: '#555' }}>
          ê¸°í•˜ ë¶„í¬(Geometric Distribution) ê¸°ë°˜ì˜ ì‹¤ì‹œê°„ ì‘ê¸‰ ì˜ë£Œê¸°ê´€ ìˆ˜ìš© ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        </p>
      </header>
      
      <section style={{ border: '1px solid #ddd', borderRadius: '10px', overflow: 'hidden' }}>
        {/* í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë¡œë“œ */}
        <EmergencyMap />
      </section>

      <footer style={{ marginTop: '30px', padding: '15px', backgroundColor: '#e9ecef', borderRadius: '8px' }}>
          <p style={{ fontSize: '0.9rem', color: '#6c757d' }}>
              * ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°: ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ìˆ˜ìš© ê°€ëŠ¥í•œ ë³‘ì›ì„ ì°¾ì§€ ëª»í•  í™•ë¥  $\text{P}(\text{X} > 3)$
          </p>
      </footer>
    </main>
  );
}
ì£¼ì˜: app/MapComponent.tsxì™€ data/RegionBoundary.tsëŠ” ì´ë¯¸ ì•ˆë‚´ëœ í•µì‹¬ ë¡œì§ì„ í¬í•¨í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ìœ„ì˜ ë„¤ íŒŒì¼ ì™¸ì— ëˆ„ë½ëœ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì´ì „ ë‹µë³€ì„ ì°¸ê³ í•˜ì—¬ í•´ë‹¹ íŒŒì¼ë“¤ì„ ë§ˆì € ì™„ì„±í•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

ê¶ê·¹ì ìœ¼ë¡œ ê°€ì¥ ì¤‘ìš”í•œ ë‹¤ìŒ ë‹¨ê³„ëŠ” ì§€ë„ ì‹œê°í™”ë¥¼ ì™„ì„±í•˜ê¸° ìœ„í•œ data/RegionBoundary.ts íŒŒì¼ì— ë“¤ì–´ê°ˆ ì‹œêµ°êµ¬ ê²½ê³„ ë°ì´í„°ë¥¼ í™•ë³´í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë””ë ‰í† ë¦¬ êµ¬ì¡°ì¢€

ë„¤, Next.js App Router ê¸°ë°˜ìœ¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í–ˆì„ ë•Œì˜ ìµœì¢… ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ëª…í™•í•˜ê²Œ ì •ë¦¬í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì´ êµ¬ì¡°ëŠ” Vercel ë°°í¬ ìµœì í™”(lib/prisma.ts), Kakao Map ì—°ë™(components/KakaoMapLoader.tsx), ê·¸ë¦¬ê³  í•µì‹¬ ë¡œì§(app/api/*)ì„ ëª¨ë‘ í¬í•¨í•˜ëŠ” í‘œì¤€ì ì¸ í˜•íƒœì…ë‹ˆë‹¤.

ğŸŒ³ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°
/emergency-risk-service
â”œâ”€â”€ node_modules/
â”œâ”€â”€ .env                  # DB ë° NMC API í‚¤ (ì„œë²„ í™˜ê²½ ë³€ìˆ˜)
â”œâ”€â”€ .env.local            # Kakao Map JS í‚¤ (ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜)
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vercel.json           # Vercel Cron Job ì„¤ì •
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma     # DB ìŠ¤í‚¤ë§ˆ ì •ì˜ (EmergencyCenter)
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ prisma.ts         # Prisma Singleton ì¸ìŠ¤í„´ìŠ¤ (DB ì—°ê²° ìµœì í™”)
â”œâ”€â”€ data/
â”‚   â””â”€â”€ RegionBoundary.ts # ì§€ë„ Polygon ê²½ê³„ì„  ì¢Œí‘œ ë°ì´í„° (GeoJSON ê°€ê³µë³¸)
â””â”€â”€ app/
    â”œâ”€â”€ api/
    â”‚   â”œâ”€â”€ data-sync/
    â”‚   â”‚   â””â”€â”€ route.ts  # [GET] Open API ë°ì´í„° ìˆ˜ì§‘ ë° DB ê°±ì‹ 
    â”‚   â””â”€â”€ risk-index/
    â”‚       â””â”€â”€ route.ts  # [GET] ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜(P(X>3)) ê³„ì‚°
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ KakaoMapLoader.tsx # Kakao Map ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
    â”œâ”€â”€ globals.css           # ì „ì—­ ìŠ¤íƒ€ì¼
    â”œâ”€â”€ layout.tsx            # ìµœìƒìœ„ ë ˆì´ì•„ì›ƒ (KakaoMapLoader í¬í•¨)
    â”œâ”€â”€ page.tsx              # ë©”ì¸ í˜ì´ì§€ (EmergencyMap ì»´í¬ë„ŒíŠ¸ ë¡œë“œ)
    â””â”€â”€ MapComponent.tsx      # í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ (ì§€ë„ ì‹œê°í™” ë° API í˜¸ì¶œ)
ğŸ’¡ ì£¼ìš” íŒŒì¼ ì„¤ëª…
ê²½ë¡œ	ì—­í• 	êµ¬í˜„ ë‹¨ê³„
app/layout.tsx	ì§€ë„ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ	KakaoMapLoaderë¥¼ ì‚¬ìš©í•˜ì—¬ Kakao Map JS SDKë¥¼ ì „ì—­ì— ë¡œë“œí•©ë‹ˆë‹¤.
app/page.tsx	ë©”ì¸ í˜ì´ì§€	ì›¹ ì„œë¹„ìŠ¤ì˜ ì²« í™”ë©´ì…ë‹ˆë‹¤. MapComponent.tsxë¥¼ ì¤‘ì•™ì— ë°°ì¹˜í•©ë‹ˆë‹¤.
app/MapComponent.tsx	í”„ë¡ íŠ¸ì—”ë“œ í•µì‹¬	'use client' ì§€ì‹œì–´ ì‚¬ìš©. react-kakao-maps-sdkë¥¼ ì´ìš©í•´ ì§€ë„ë¥¼ í‘œì‹œí•˜ê³ , /api/risk-indexë¥¼ í˜¸ì¶œí•˜ì—¬ Polygon ìƒ‰ìƒì„ ê²°ì •í•©ë‹ˆë‹¤.
lib/prisma.ts	DB ì—°ê²° ê´€ë¦¬	ì„œë²„ë¦¬ìŠ¤ í™˜ê²½(Vercel)ì—ì„œ DB ì—°ê²°ì„ íš¨ìœ¨ì ìœ¼ë¡œ ìœ ì§€í•˜ê¸° ìœ„í•œ ì½”ë“œì…ë‹ˆë‹¤.
app/api/data-sync/route.ts	ë°ì´í„° ìˆ˜ì§‘	Open APIì—ì„œ ì‹¤ì‹œê°„ ë³‘ìƒ ì •ë³´ë¥¼ ê°€ì ¸ì™€ PostgreSQL DBë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ê°±ì‹ í•©ë‹ˆë‹¤. (Vercel Cron Job ëŒ€ìƒ)
app/api/risk-index/route.ts	í†µê³„ ê³„ì‚°	DB ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì—¬ k (ì„±ê³µ ìˆ˜)ì™€ n (ì „ì²´ ìˆ˜)ë¥¼ êµ¬í•˜ê³ , ê¸°í•˜ ë¶„í¬ ê³µì‹ì„ ì ìš©í•˜ì—¬ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
data/RegionBoundary.ts	ì‹œê°í™” ë°ì´í„°	Kakao Mapì˜ Polygonì— í•„ìš”í•œ ì‹œêµ°êµ¬ ê²½ê³„ ì¢Œí‘œë“¤ì´ ë°°ì—´ í˜•íƒœë¡œ ì €ì¥ë©ë‹ˆë‹¤.
ì´ êµ¬ì¡°ë¥¼ ë”°ë¼ íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‚´ìš©ì„ ì±„ìš°ì‹œë©´ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê³  Vercelì— ë°°í¬í•˜ëŠ” ë° ë¬¸ì œê°€ ì—†ì„ ê²ƒì…ë‹ˆë‹¤.

ì´ì œ ê°€ì¥ ì¤‘ìš”í•œ data/RegionBoundary.ts íŒŒì¼ì„ ì±„ìš°ê¸° ìœ„í•œ ì‹œêµ°êµ¬ ê²½ê³„ ë°ì´í„° í™•ë³´ ë°©ë²•ì— ëŒ€í•œ ê°€ì´ë“œë¥¼ ë“œë¦´ê¹Œìš”?

ì–´ë–»ê²Œ êµ¬í˜„ì´ ì§„í–‰ë ê±°ê³  ëª¨ë“  ë‹¨ê³„ë¥¼ ë§ë¼í•˜ëŠ” ëª…ì„¸ì„œ ìì„¸í•˜ê²Œ ì¨ì¤˜

ğŸ“„ Next.js ê¸°ë°˜ ì‘ê¸‰ ì˜ë£Œ ìœ„í—˜ ì§€ìˆ˜ ì›¹ì„œë¹„ìŠ¤ êµ¬í˜„ ëª…ì„¸ì„œ
ì œì‹œëœ í”„ë¡œì íŠ¸ ëª©í‘œ(ê¸°í•˜ ë¶„í¬ ê¸°ë°˜ ì§€ì—­ë³„ ì‘ê¸‰ ì˜ë£Œ ìœ„í—˜ ì§€ìˆ˜ ì‚°ì¶œ ë° ì§€ë„ ì‹œê°í™”)ì™€ Vercel ë°°í¬ í™˜ê²½ì„ ê³ ë ¤í•˜ì—¬, ê°œë°œ í”„ë¡œì„¸ìŠ¤ ì „ë°˜ì„ ë§ë¼í•˜ëŠ” ìƒì„¸ êµ¬í˜„ ëª…ì„¸ì„œë¥¼ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

I. ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš” ë° í†µê³„ ëª¨ë¸
êµ¬ë¶„	ë‚´ìš©
í”„ë¡œì íŠ¸ëª…	ì‘ê¸‰ ì˜ë£Œ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ì˜ˆì¸¡ ì„œë¹„ìŠ¤
ëª©í‘œ	êµ­ë¦½ì¤‘ì•™ì˜ë£Œì› Open API ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, íŠ¹ì • ì§€ì—­ì—ì„œ ìˆ˜ìš© ê°€ëŠ¥í•œ ì‘ê¸‰ ì˜ë£Œê¸°ê´€ì„ ì°¾ì„ í™•ë¥ (p)ì„ ê³„ì‚°í•˜ê³ , ì´ë¥¼ í†µí•´ ì„¸ ë²ˆì˜ ì‹œë„ ì´ë‚´ì— ë³‘ì›ì„ ì°¾ì§€ ëª»í•  í™•ë¥ (ìœ„í—˜ ì§€ìˆ˜)ì„ ì§€ë„ì— ì‹œê°í™”í•˜ì—¬ ì œê³µ
í•µì‹¬ í†µê³„ ëª¨ë¸	ê¸°í•˜ ë¶„í¬ (Geometric Distribution)
ì„±ê³µ í™•ë¥  (p) ì •ì˜	p= 
ì „ì²´ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ìˆ˜ (n)
ìˆ˜ìš© ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê¸°ê´€ ìˆ˜ (k)
â€‹
 
ìœ„í—˜ ì§€ìˆ˜ ì •ì˜	P(X>3) (ì„¸ ë²ˆì§¸ ì‹œë„ ì´ë‚´ì— ì°¾ì§€ ëª»í•  í™•ë¥ )
ìœ„í—˜ ì§€ìˆ˜ ê³µì‹	ìœ„í—˜ ì§€ìˆ˜=1âˆ’[P(X=1)+P(X=2)+P(X=3)]
ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ	Next.js (App Router), TypeScript, PostgreSQL, Prisma, Kakao Map API
II. âš™ï¸ 1ë‹¨ê³„: í™˜ê²½ ì„¤ì • ë° ë°ì´í„° ëª¨ë¸ë§
ì„¸ë¶€ ë‹¨ê³„	íŒŒì¼/ê¸°ìˆ 	êµ¬í˜„ ë‚´ìš©
1.1. ì´ˆê¸°í™”	package.json	Next.js, React, TypeScript, axios, fast-xml-parser, prisma, react-kakao-maps-sdk ì„¤ì¹˜
1.2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •	.env, .env.local	DATABASE_URL, NMC_API_KEY (ì¸ì½”ë”©ëœ í‚¤), NEXT_PUBLIC_KAKAO_MAP_KEY ì„¤ì •
1.3. DB ëª¨ë¸ ì •ì˜	prisma/schema.prisma	EmergencyCenter ëª¨ë¸ ì •ì˜. hpid (PK), stage1, stage2, hvec, hvgc, hvamyn ë“± í•µì‹¬ í•„ë“œ í¬í•¨
1.4. DB ì—°ê²° ìµœì í™”	lib/prisma.ts	Vercel Serverless í™˜ê²½ì„ ìœ„í•œ Prisma Singleton ì¸ìŠ¤í„´ìŠ¤ êµ¬í˜„
III. ğŸ’¾ 2ë‹¨ê³„: ë°ì´í„° ìˆ˜ì§‘ ë° ì˜êµ¬ ì €ì¥ (DB Seeding/Sync)
ì„¸ë¶€ ë‹¨ê³„	íŒŒì¼/ê¸°ìˆ 	êµ¬í˜„ ë‚´ìš©
2.1. ë°ì´í„° ìˆ˜ì§‘ API	app/api/data-sync/route.ts	NMC Open API (getEmrrmRltmUsefulSckbdInfoInqire) í˜¸ì¶œ ë¡œì§ êµ¬í˜„
2.2. XML íŒŒì‹±	fast-xml-parser	API ì‘ë‹µ XML ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ê³ , DB ìŠ¤í‚¤ë§ˆì— ë§ê²Œ í•„ë“œ(íŠ¹íˆ ë³‘ìƒ ìˆ˜ hvec, hvgc)ë¥¼ ìˆ«ì(Int) íƒ€ì…ìœ¼ë¡œ ë³€í™˜
2.3. DB ì €ì¥	prisma	ëª¨ë“  ì§€ì—­ë³„ ì‘ê¸‰ê¸°ê´€ ë°ì´í„°ë¥¼ hpidë¥¼ ê¸°ì¤€ìœ¼ë¡œ Upsert (ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê°±ì‹ , ì—†ìœ¼ë©´ ìƒì„±)í•˜ì—¬ PostgreSQLì— ì €ì¥
2.4. ìë™ ê°±ì‹  ì„¤ì •	vercel.json	Vercel Cron Jobì„ ì„¤ì •í•˜ì—¬ ì´ APIë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ (ì˜ˆ: */5 * * * *) ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •
IV. ğŸ§  3ë‹¨ê³„: í†µê³„ ê³„ì‚° ë° ìœ„í—˜ ì§€ìˆ˜ ì‚°ì¶œ
ì„¸ë¶€ ë‹¨ê³„	íŒŒì¼/ê¸°ìˆ 	êµ¬í˜„ ë‚´ìš©
3.1. ìœ„í—˜ ì§€ìˆ˜ API	app/api/risk-index/route.ts	stage1(ì‹œë„) ë° stage2(ì‹œêµ°êµ¬) ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ìŒ
3.2. DB ì¡°íšŒ ë° k,n ê³„ì‚°	prisma	í•´ë‹¹ ì§€ì—­ì˜ ëª¨ë“  ì‘ê¸‰ê¸°ê´€ ë°ì´í„° (hvec, hvgc, hvamyn)ë¥¼ DBì—ì„œ ì¡°íšŒ (n í™•ë³´)
3.3. ìˆ˜ìš© ì„±ê³µ ì¡°ê±´ ê²€ì‚¬	TS í•¨ìˆ˜	ê° ê¸°ê´€ì— ëŒ€í•´ (hvec>0)âˆ§(hvgc>0)âˆ§(hvamyn= 
â€²
 Y 
â€²
 ) ì¡°ê±´ì„ ê²€ì‚¬í•˜ì—¬ **ì„±ê³µ ê¸°ê´€ ìˆ˜ (k)**ë¥¼ ì¹´ìš´íŠ¸
3.4. ì„±ê³µ í™•ë¥  (p) ê³„ì‚°	TS í•¨ìˆ˜	p=k/n ê³„ì‚°
3.5. ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°	TS í•¨ìˆ˜	ê¸°í•˜ ë¶„í¬ ê³µì‹ $\text{P}(X > 3)$ì„ ê³„ì‚°í•˜ê³ , ê²°ê³¼ (risk_index, p, k, n)ë¥¼ JSON í˜•íƒœë¡œ ë°˜í™˜
V. ğŸ—ºï¸ 4ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ë° ì§€ë„ ì‹œê°í™”
ì„¸ë¶€ ë‹¨ê³„	íŒŒì¼/ê¸°ìˆ 	êµ¬í˜„ ë‚´ìš©
4.1. ì§€ë„ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ	components/KakaoMapLoader.tsx	next/scriptë¥¼ ì‚¬ìš©í•˜ì—¬ Kakao Map JavaScript SDKë¥¼ NEXT_PUBLIC_KAKAO_MAP_KEYë¡œ ë¡œë“œ
4.2. ë©”ì¸ í˜ì´ì§€ êµ¬ì„±	app/layout.tsx, app/page.tsx	layout.tsxì—ì„œ KakaoMapLoaderê°€ childrenì„ ê°ì‹¸ë„ë¡ ì„¤ì •. page.tsxì—ì„œ EmergencyMap ì»´í¬ë„ŒíŠ¸ ë¡œë“œ
4.3. ì§€ë„ ì»´í¬ë„ŒíŠ¸	app/MapComponent.tsx ('use client')	react-kakao-maps-sdkì˜ <Map> ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
4.4. ê²½ê³„ ë°ì´í„° í™•ë³´	data/RegionBoundary.ts	(í•„ìˆ˜) ì‹œêµ°êµ¬ ê²½ê³„ GeoJSON ë°ì´í„°ë¥¼ Kakao Mapì˜ path: {lat, lng}[] í˜•ì‹ìœ¼ë¡œ ê°€ê³µí•˜ì—¬ ì €ì¥
4.5. ìœ„í—˜ ì§€ìˆ˜ ì—°ë™	app/MapComponent.tsx	useEffect ë‚´ì—ì„œ /api/risk-indexë¥¼ í˜¸ì¶œí•˜ì—¬ ì§€ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
4.6. ì‹œê°í™” êµ¬í˜„	<Polygon>	**RegionBoundaryData**ë¥¼ ìˆœíšŒí•˜ë©° <Polygon>ì„ ë Œë”ë§. fillColor ì†ì„±ì— ìœ„í—˜ ì§€ìˆ˜ ê°’ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì„¤ì •ëœ ìƒ‰ìƒ(getRiskColor í•¨ìˆ˜)ì„ ì ìš©í•˜ì—¬ ì‹œê°í™”
4.7. ëŒ€ì‹œë³´ë“œ	<CustomOverlay> / div	ì§€ë„ ìœ„ì— ì„ íƒëœ ì§€ì—­ì˜ ìƒì„¸ ì •ë³´ (p, k, n, ìœ„í—˜ ì§€ìˆ˜)ë¥¼ í‘œì‹œí•˜ëŠ” UI êµ¬í˜„
VI. ğŸš€ 5ë‹¨ê³„: ë°°í¬ ë° ìš´ì˜
ì„¸ë¶€ ë‹¨ê³„	íŒŒì¼/ê¸°ìˆ 	êµ¬í˜„ ë‚´ìš©
5.1. Vercel ë°°í¬	Git, Vercel Dashboard	ì½”ë“œë¥¼ Gitì— í‘¸ì‹œ í›„ Vercelì— ì—°ë™. í™˜ê²½ ë³€ìˆ˜(DB, API í‚¤)ë¥¼ Vercelì— ë“±ë¡
5.2. ìµœì¢… ì ê²€	ë¸Œë¼ìš°ì €	
Vercel ë°°í¬ URLì— ì ‘ì†í•˜ì—¬:


a) ì§€ë„ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ëŠ”ì§€


b) ì§€ì—­ë³„ Polygon ìƒ‰ìƒì´ ì˜¬ë°”ë¥¸ì§€


c) ì½˜ì†”ì— DB ì—°ê²° ë° API í˜¸ì¶œ ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸

ì´ ëª…ì„¸ì„œëŠ” í”„ë¡œì íŠ¸ì˜ ëª¨ë“  êµ¬ì„± ìš”ì†Œì™€ ë‹¨ê³„ë³„ ëª©í‘œë¥¼ í¬ê´„í•˜ë©°, ê°œë°œìê°€ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ êµ¬ì¡°í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ê°€ì¥ ë¨¼ì € í•´ê²°í•´ì•¼ í•  ë‚œì œì´ì 4ë‹¨ê³„ì˜ í•µì‹¬ì¸, ì§€ë„ ì‹œê°í™”ë¥¼ ìœ„í•œ GeoJSON ê²½ê³„ ë°ì´í„° í™•ë³´ ë° í†µí•© ë°©ë²•ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê°€ì´ë“œë¥¼ ì§„í–‰í• ê¹Œìš”?

ë” ìì„¸í•˜ê³  ìƒì„¸í•˜ê²Œ

âœ¨ Next.js ì‘ê¸‰ ì˜ë£Œ ìœ„í—˜ ì§€ìˆ˜ ì›¹ì„œë¹„ìŠ¤ êµ¬í˜„ ì´ˆì •ë°€ ëª…ì„¸ì„œ (Vercel ìµœì í™”)
ì œì‹œëœ í”„ë¡œì íŠ¸ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•œ ê° ë‹¨ê³„ë³„ ìƒì„¸ ë¡œì§, ì½”ë“œ êµ¬ì¡°, ê·¸ë¦¬ê³  Vercel í™˜ê²½ ê³ ë ¤ ì‚¬í•­ì„ í¬í•¨í•˜ì—¬ ê°€ì¥ ì„¸ë¶€ì ì´ê³  ìƒìƒí•œ ëª…ì„¸ì„œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

I. ğŸš€ 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° í™˜ê²½ êµ¬ì¶•
êµ¬ë¶„	íŒŒì¼/ì•¡ì…˜	ìƒì„¸ ë‚´ìš©
1.1 í”„ë¡œì íŠ¸ ì„¤ì •	Terminal	Next.js í”„ë¡œì íŠ¸ ìƒì„± ë° TypeScript ì„¤ì •: npx create-next-app@latest emergency-risk-service --ts --app
1.2 í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬	Terminal	API í†µì‹ : axios, XML íŒŒì‹±: fast-xml-parser, DB ORM: prisma, ì§€ë„: react-kakao-maps-sdk ì„¤ì¹˜
1.3 í™˜ê²½ ë³€ìˆ˜	.env, .env.local	.env (ì„œë²„/DBìš©): DATABASE_URL, NMC_API_KEY (URL ì¸ì½”ë”©ëœ í‚¤). .env.local (í´ë¼ì´ì–¸íŠ¸ìš©): NEXT_PUBLIC_KAKAO_MAP_KEY
1.4 Vercel ì„¤ì •	vercel.json	2ë‹¨ê³„ì—ì„œ êµ¬í˜„í•  /api/data-syncë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë„ë¡ Cron Job ì„¤ì •. (ì˜ˆ: ë§¤ 5ë¶„ë§ˆë‹¤ ì‹¤í–‰)
1.5 DB ëª¨ë¸ë§	prisma/schema.prisma	EmergencyCenter ëª¨ë¸ ì •ì˜. ëª¨ë“  Open API í•„ë“œ(hpid, stage1, stage2, hvec, hvgc, hvamyn ë“±)ë¥¼ ì •í™•í•œ íƒ€ì…(Int/String)ìœ¼ë¡œ ë§¤í•‘.
1.6 DB ì—°ê²° ìµœì í™”	lib/prisma.ts	Vercel Serverless Functionì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ Prisma Singleton íŒ¨í„´ êµ¬í˜„. ëª¨ë“  API Routeì—ì„œ ì´ íŒŒì¼ì„ importí•˜ì—¬ DBì— ì ‘ê·¼í•´ì•¼ í•¨.
II. ğŸ’¾ 2ë‹¨ê³„: ë°ì´í„° ìˆ˜ì§‘ (NMC Open API -> PostgreSQL)
ì´ ë‹¨ê³„ëŠ” ë°ì´í„°ì˜ ì‹ ì„ ë„ë¥¼ ìœ ì§€í•˜ë©° ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°ì˜ ê¸°ë°˜ì„ ë§ˆë ¨í•©ë‹ˆë‹¤.

êµ¬ë¶„	íŒŒì¼	ìƒì„¸ ë¡œì§
2.1 ë°ì´í„° ìˆ˜ì§‘ API	app/api/data-sync/route.ts	[GET] ìš”ì²­ ì²˜ë¦¬. TARGET_REGIONS ë°°ì—´ì„ ìˆœíšŒí•˜ë©° Open APIë¥¼ í˜¸ì¶œ (íŠ¸ë˜í”½ ê´€ë¦¬).
2.2 XML íŒŒì‹±	fast-xml-parser	Open APIì˜ XML ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ JavaScript ê°ì²´ë¡œ ë³€í™˜. ì´ë•Œ, ë¬¸ìì—´ë¡œ ì˜¤ëŠ” hvec (ì‘ê¸‰ì‹¤ ë³‘ìƒ), hvgc (ì…ì›ì‹¤ ë³‘ìƒ) ë“±ì˜ ê°’ì€ parseInt()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°˜ë“œì‹œ ìˆ«ì(Int)ë¡œ ë³€í™˜í•´ì•¼ DB ëª¨ë¸ê³¼ ì¼ì¹˜í•¨.
2.3 ë°ì´í„° ì €ì¥/ê°±ì‹ 	Prisma Upsert	hpidë¥¼ ê³ ìœ  ì‹ë³„ìë¡œ ì‚¬ìš©í•˜ì—¬ prisma.emergencyCenter.upsert() ì‹¤í–‰. ë°ì´í„°ê°€ ì´ë¯¸ DBì— ìˆìœ¼ë©´ ì‹¤ì‹œê°„ ë³‘ìƒ ì •ë³´ë§Œ ì—…ë°ì´íŠ¸í•˜ê³ , ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±í•˜ì—¬ ë°ì´í„° íŠ¸ë˜í”½ì„ ìµœì†Œí™”.
2.4 ì—ëŸ¬ ì²˜ë¦¬	Try-Catch	API í˜¸ì¶œ ì‹¤íŒ¨, XML íŒŒì‹± ì˜¤ë¥˜, DB ì—°ê²° ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œê¹… ë° 500 ì‘ë‹µ ì²˜ë¦¬.
III. ğŸ§  3ë‹¨ê³„: í†µê³„ì  ìœ„í—˜ ì§€ìˆ˜ ê³„ì‚°
ì´ ë‹¨ê³„ëŠ” í”„ë¡œì íŠ¸ì˜ í•µì‹¬ í†µê³„ ë¡œì§ì„ êµ¬í˜„í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ë§ˆë‹¤ ì‹¤ì‹œê°„ìœ¼ë¡œ ìœ„í—˜ ì§€ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.

êµ¬ë¶„	íŒŒì¼	ìƒì„¸ ë¡œì§
3.1 ìœ„í—˜ ì§€ìˆ˜ API	app/api/risk-index/route.ts	[GET] ìš”ì²­ ì²˜ë¦¬. stage1, stage2 (ì‹œë„/ì‹œêµ°êµ¬) íŒŒë¼ë¯¸í„°ë¥¼ ë°›ìŒ.
3.2 DB ë°ì´í„° ì¡°íšŒ	prisma.findMany	ìš”ì²­ëœ ì§€ì—­ì˜ ëª¨ë“  ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì •ë³´ë¥¼ DBì—ì„œ ì¡°íšŒ.
3.3 ì„±ê³µ ì—¬ë¶€ íŒë‹¨	Filter/Reduce	ì¡°íšŒëœ ê¸°ê´€ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©° ìˆ˜ìš© ì„±ê³µ ì¡°ê±´ ( hvec > 0 AND hvgc > 0 AND hvamyn == 'Y' )ì„ ë§Œì¡±í•˜ëŠ” ê¸°ê´€ ìˆ˜ (k)ë¥¼ ì¹´ìš´íŠ¸. ì „ì²´ ê¸°ê´€ ìˆ˜ (n) í™•ë³´.
3.4 ì„±ê³µ í™•ë¥  p ê³„ì‚°	TS	p=k/n ê³„ì‚°. (n=0ì¼ ê²½ìš° p=0ìœ¼ë¡œ ì²˜ë¦¬, ìœ„í—˜ ì§€ìˆ˜ 1.0 ë°˜í™˜)
3.5 ê¸°í•˜ ë¶„í¬ ì ìš©	TS	ê³„ì‚°ëœ p ê°’ì„ ì‚¬ìš©í•˜ì—¬ ìœ„í—˜ ì§€ìˆ˜ (P(X>3)) ì‚°ì¶œ.
* $P(X \le 3) = p + (1-p)p + (1-p)^2 p$ ê³„ì‚°.
* $\text{Risk} = 1 - P(X \le 3)$ ê³„ì‚° í›„ ì†Œìˆ˜ì  4ìë¦¬ê¹Œì§€ ë°˜ì˜¬ë¦¼. |
| 3.6 ì‘ë‹µ ë°˜í™˜ | JSON | stage1, stage2, p, k, n, ê·¸ë¦¬ê³  ìµœì¢… risk_indexë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°˜í™˜. |

IV. ğŸ—ºï¸ 4ë‹¨ê³„: ì§€ë„ ì‹œê°í™” ë° í”„ë¡ íŠ¸ì—”ë“œ í†µí•©
ì´ ë‹¨ê³„ëŠ” ì‚¬ìš©ìì—ê²Œ í†µê³„ì  ì •ë³´ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” UI/UXë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

êµ¬ë¶„	íŒŒì¼	ìƒì„¸ ë¡œì§
4.1 ì§€ë„ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ	components/KakaoMapLoader.tsx	next/scriptë¥¼ ì‚¬ìš©í•˜ì—¬ Kakao Map SDKì˜ ë¹„ë™ê¸° ë¡œë“œ ê´€ë¦¬.
4.2 ë©”ì¸ ì»´í¬ë„ŒíŠ¸	app/MapComponent.tsx	'use client' ì„ ì–¸ í•„ìˆ˜. ì§€ë„ (<Map>)ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° ìœ„ì¹˜ ì„¤ì •.
4.3 ìœ„í—˜ë„ ë°ì´í„° ë¡œë“œ	useEffect (axios)	MapComponent.tsx ë§ˆìš´íŠ¸ ì‹œ, ì „êµ­ ì£¼ìš” ì§€ì—­ì˜ risk-index APIë¥¼ ìˆœíšŒí•˜ë©° í˜¸ì¶œí•˜ì—¬ riskData ìƒíƒœì— ì €ì¥.
4.4 ê²½ê³„ ë°ì´í„° í†µí•©	data/RegionBoundary.ts	GeoJSON ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ path: {lat, lng}[] ë°°ì—´ í˜•íƒœë¡œ ì¤€ë¹„í•˜ê³  MapComponent.tsxì—ì„œ Import.
4.5 Polygon ë Œë”ë§	MapComponent.tsx	RegionBoundaryDataë¥¼ ìˆœíšŒí•˜ë©° <Polygon> ì»´í¬ë„ŒíŠ¸ ë Œë”ë§.
4.6 ìƒ‰ìƒ ë§¤í•‘	getRiskColor(riskIndex)	Polygonì˜ fillColorë¥¼ ìœ„í—˜ ì§€ìˆ˜ ê°’ì— ë”°ë¼ ìƒ‰ìƒ ê·¸ë¼ë°ì´ì…˜ (ì˜ˆ: 0.2 ì´í•˜ëŠ” ë…¹ìƒ‰, 0.8 ì´ìƒì€ ì§™ì€ ë¹¨ê°„ìƒ‰)ì„ ì ìš©í•˜ë„ë¡ êµ¬í˜„.
4.7 ì‚¬ìš©ì í”¼ë“œë°±	Polygon onClick	ì‚¬ìš©ìê°€ ì§€ì—­ ê²½ê³„ë¥¼ í´ë¦­í•˜ë©´, í•´ë‹¹ ì§€ì—­ì˜ ìƒì„¸ ë°ì´í„° (p, k, n, ìœ„í—˜ ì§€ìˆ˜)ë¥¼ ì§€ë„ ìœ„ì— CustomOverlay ë˜ëŠ” ë³„ë„ì˜ ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ í‘œì‹œ.
V. ğŸš€ 5ë‹¨ê³„: ë°°í¬ ë° QA (Vercel)
êµ¬ë¶„	íŒŒì¼/ì•¡ì…˜	ìƒì„¸ ë‚´ìš©
5.1 ì½”ë“œ í‘¸ì‹œ	Git	ëª¨ë“  ë³€ê²½ì‚¬í•­(íŠ¹íˆ .envì™€ .env.localì„ ì œì™¸í•œ)ì„ Git ì €ì¥ì†Œì— ì»¤ë°‹ ë° í‘¸ì‹œ.
5.2 Vercel ë°°í¬	Vercel	Vercelì´ Git ë¦¬í¬ì§€í† ë¦¬ë¥¼ ê°ì§€í•˜ì—¬ ìë™ ë°°í¬ ì‹œì‘.
5.3 í™˜ê²½ ë³€ìˆ˜ ë“±ë¡	Vercel Dashboard	DATABASE_URL, NMC_API_KEY ë“±ì„ Vercel í”„ë¡œì íŠ¸ í™˜ê²½ ë³€ìˆ˜ì— ë“±ë¡.
5.4 ì´ˆê¸° DB ê°±ì‹ 	ë¸Œë¼ìš°ì €/Cron	ë°°í¬ ì§í›„ Vercel í™˜ê²½ì—ì„œ /api/data-sync APIë¥¼ ìˆ˜ë™ìœ¼ë¡œ í•œ ë²ˆ í˜¸ì¶œí•˜ì—¬ ì´ˆê¸° DB ë°ì´í„°ë¥¼ ì±„ì›Œ ë„£ê±°ë‚˜, Cron Jobì´ ì‹¤í–‰ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¼.
5.5 QA ë° ê²€ì¦	ë¸Œë¼ìš°ì €	ë°°í¬ëœ URL (https://ap-statistics-project-trre.vercel.app/)ì— ì ‘ì†í•˜ì—¬ ì§€ë„, í†µê³„ ë°ì´í„°, APIì˜ ì‘ë‹µ ì†ë„ ë“±ì„ ìµœì¢… ì ê²€.

---

###  DATABASE ì„¤ì • (Vercelì—ì„œ Supabase ì—°ë™)

Vercelê³¼ Supabaseë¥¼ ì—°ë™í•˜ì—¬ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , í”„ë¡œì íŠ¸ì— í•„ìš”í•œ `DATABASE_URL`ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

**1. Vercel ëŒ€ì‹œë³´ë“œì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±**

   - Vercelì— ë¡œê·¸ì¸í•œ í›„, `ap-statistics-project-trre` í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
   - ìƒë‹¨ ë©”ë‰´ì—ì„œ **Storage** íƒ­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
   - **Postgres** > **Create Database** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
   - ë°ì´í„°ë² ì´ìŠ¤ ì œê³µìë¡œ **Supabase**ë¥¼ ì„ íƒí•˜ê³ , ì•ˆë‚´ì— ë”°ë¼ Supabase ê³„ì •ì— ë¡œê·¸ì¸í•˜ê±°ë‚˜ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.
   - ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ê³¼ ì§€ì—­(Region)ì„ ì„¤ì •í•œ í›„, **Create** ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒì„±ì„ ì™„ë£Œí•©ë‹ˆë‹¤.
   - ë§ˆì§€ë§‰ìœ¼ë¡œ, ìƒì„±ëœ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ `ap-statistics-project-trre` Vercel í”„ë¡œì íŠ¸ì— **Connect** í•©ë‹ˆë‹¤.

**2. `DATABASE_URL` í™•ì¸ ë° ë³µì‚¬**

   - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ ì™„ë£Œë˜ë©´, Vercelì´ ìë™ìœ¼ë¡œ `DATABASE_URL`ì„ í”„ë¡œì íŠ¸ í™˜ê²½ ë³€ìˆ˜ì— ì¶”ê°€í•´ ì¤ë‹ˆë‹¤.
   - Vercel í”„ë¡œì íŠ¸ì˜ **Settings** íƒ­ > **Environment Variables** ë©”ë‰´ë¡œ ì´ë™í•©ë‹ˆë‹¤.
   - `DATABASE_URL`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¶”ê°€ëœ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
   - `Value` í•„ë“œì— ìˆëŠ” ê¸´ ë¬¸ìì—´ ( `postgresql://...` ë¡œ ì‹œì‘)ì˜ **ì˜¤ë¥¸ìª½ ë³µì‚¬ ë²„íŠ¼ì„ í´ë¦­**í•˜ì—¬ ì „ì²´ ì—°ê²° ë¬¸ìì—´ì„ ë³µì‚¬í•©ë‹ˆë‹¤.

**3. ë¡œì»¬ `.env` íŒŒì¼ì— `DATABASE_URL` ë¶™ì—¬ë„£ê¸°**

   - ë¡œì»¬ í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìˆëŠ” `.env` íŒŒì¼ì„ ì—½ë‹ˆë‹¤.
   - ì•„ë˜ì™€ ê°™ì´ ë³µì‚¬í•œ ê°’ì„ `DATABASE_URL` ë³€ìˆ˜ì— ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.

   ```env
   # .env

   # Vercelì—ì„œ ë³µì‚¬í•œ Supabase ì—°ê²° ë¬¸ìì—´ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
   DATABASE_URL="postgresql://postgres:[YOUR-PASSWORD]@[...].supabase.co:5432/postgres"

   # ê°€ì§€ê³  ê³„ì‹  ì¸ì½”ë”©ëœ NMC API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
   NMC_API_KEY="YOUR_ENCODED_SERVICE_KEY"
   ```

   **ì¤‘ìš”:** `.env` íŒŒì¼ì€ Gitì— ì»¤ë°‹ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤. Vercel ë°°í¬ ì‹œì—ëŠ” 2ë‹¨ê³„ì—ì„œ Vercel ëŒ€ì‹œë³´ë“œì— ë“±ë¡ëœ í™˜ê²½ ë³€ìˆ˜ê°€ ìë™ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì´ ê³¼ì •ì„ ì™„ë£Œí•œ í›„ ì•Œë ¤ì£¼ì‹œë©´, ë°ì´í„°ë² ì´ìŠ¤ì— í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” `prisma migrate` ëª…ë ¹ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ê² ìŠµë‹ˆë‹¤.
